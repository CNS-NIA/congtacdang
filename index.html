<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Chương trình Quản lý Công tác Đảng</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        :root {
            --primary-red: #8B0000;
            --primary-red-dark: #5A0000;
            --primary-red-light: #A52A2A;
            --party-gold: #FFD700;
            --light-bg: #F8F8F8;
            --white: #FFFFFF;
            --light-gray: #F5F5F5;
            --medium-gray: #E0E0E0;
            --dark-gray: #333333;
            --text-dark: #222222;
            --text-light: #666666;
            --success: #28a745;
            --info: #17a2b8;
            --warning: #ffc107;
            --danger: #dc3545;
            --border-radius: 8px;
            --shadow: 0 4px 12px rgba(0, 0, 0, 0.08);
            --shadow-lg: 0 8px 25px rgba(0, 0, 0, 0.12);
            --transition: all 0.3s ease;
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', 'Roboto', 'Arial', sans-serif;
        }

        body {
            background-color: var(--light-bg);
            color: var(--text-dark);
            line-height: 1.6;
        }

        /* ANIMATION */
        @keyframes gentle-wave {
            0% { transform: rotate(0deg) translateY(0); }
            25% { transform: rotate(1.5deg) translateY(-2px); }
            50% { transform: rotate(0deg) translateY(0); }
            75% { transform: rotate(-1.5deg) translateY(2px); }
            100% { transform: rotate(0deg) translateY(0); }
        }

        @keyframes float {
            0% { transform: translateY(0px) rotate(0deg); }
            50% { transform: translateY(-3px) rotate(1deg); }
            100% { transform: translateY(0px) rotate(0deg); }
        }

        @keyframes gold-shine {
            0% { text-shadow: 2px 2px 4px rgba(0,0,0,0.3); }
            50% { text-shadow: 2px 2px 4px rgba(0,0,0,0.3), 0 0 15px #FFD700; }
            100% { text-shadow: 2px 2px 4px rgba(0,0,0,0.3); }
        }

        /* HEADER */
        .header {
            background: linear-gradient(135deg, #8B0000, #5A0000);
            color: white;
            padding: 10px 30px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.2);
            position: sticky;
            top: 0;
            z-index: 100;
            border-bottom: 3px solid #FFD700;
            height: 100px;
        }

        .logo-area {
            display: flex;
            align-items: center;
            width: 260px;
            height: 80px;
            position: relative;
        }

        .flag-container {
            width: 100%;
            height: 100%;
            position: relative;
            cursor: pointer;
            overflow: hidden;
            background: transparent;
            border-radius: 4px;
        }

        .flag {
            width: 100%;
            height: 100%;
            position: relative;
            animation: gentle-wave 4s ease-in-out infinite;
            transform-origin: left center;
            background: linear-gradient(135deg, #FFD700, #FFA500);
            border-radius: 4px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .flag::before {
            content: "★";
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            font-size: 45px;
            color: #8B0000;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.2);
            z-index: 2;
        }

        .flag::after {
            content: "";
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(90deg, transparent 0%, rgba(255, 255, 255, 0.1) 50%, transparent 100%);
            animation: shine 3s infinite;
        }

        @keyframes shine {
            0% { transform: translateX(-100%); }
            20% { transform: translateX(100%); }
            100% { transform: translateX(100%); }
        }

        .logo-overlay {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            display: flex;
            align-items: center;
            justify-content: center;
            background: rgba(0, 0, 0, 0.5);
            color: white;
            font-size: 12px;
            font-weight: 600;
            opacity: 0;
            transition: opacity 0.3s;
            z-index: 3;
            border-radius: 4px;
            cursor: pointer;
        }

        .flag-container:hover .logo-overlay {
            opacity: 1;
        }

        .flag-container.has-logo .flag::before,
        .flag-container.has-logo .flag::after {
            display: none;
        }

        .flag-container.has-logo {
            background: transparent;
        }

        .flag-container.has-logo img {
            width: 100%;
            height: 100%;
            object-fit: contain;
            animation: float 4s ease-in-out infinite;
            border-radius: 4px;
        }

        .system-name {
            flex: 1;
            text-align: center;
            margin: 0 20px;
        }

        .system-name h1 {
            font-size: 26px;
            font-weight: 700;
            margin-bottom: 5px;
            letter-spacing: 1px;
            color: #FFD700;
            text-transform: uppercase;
            animation: gold-shine 3s ease-in-out infinite;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.3);
        }

        .system-name p {
            font-size: 15px;
            font-style: normal;
            font-weight: 600;
            color: white;
            letter-spacing: 0.5px;
            text-transform: uppercase;
        }

        /* SIDEBAR */
        .sidebar {
            width: 260px;
            background: var(--white);
            position: fixed;
            left: 0;
            top: 100px;
            bottom: 0;
            overflow-y: auto;
            box-shadow: 2px 0 10px rgba(0, 0, 0, 0.05);
            z-index: 90;
            border-right: 1px solid var(--medium-gray);
        }

        .menu-section {
            padding: 20px 0;
            border-bottom: 1px solid var(--medium-gray);
        }

        .menu-title {
            padding: 0 20px 10px 20px;
            font-size: 14px;
            font-weight: 600;
            color: #8B0000;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .menu-list {
            list-style: none;
        }

        .menu-item {
            padding: 12px 20px;
            display: flex;
            align-items: center;
            gap: 12px;
            cursor: pointer;
            transition: var(--transition);
            color: var(--text-dark);
            text-decoration: none;
            border-left: 3px solid transparent;
            font-size: 15px;
        }

        .menu-item:hover {
            background-color: rgba(139, 0, 0, 0.05);
            color: #8B0000;
        }

        .menu-item.active {
            background-color: rgba(139, 0, 0, 0.08);
            color: #8B0000;
            border-left: 3px solid #8B0000;
            font-weight: 600;
        }

        .menu-item i {
            width: 20px;
            text-align: center;
            font-size: 16px;
        }

        .submenu {
            list-style: none;
            margin-left: 40px;
            margin-top: 5px;
            max-height: 0;
            overflow: hidden;
            transition: max-height 0.3s ease;
        }

        .submenu.show {
            max-height: 400px;
        }

        .submenu-item {
            padding: 8px 0;
            font-size: 14px;
            color: var(--text-light);
            cursor: pointer;
            transition: var(--transition);
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .submenu-item:hover {
            color: #8B0000;
        }

        .submenu-item i {
            font-size: 12px;
        }

        .submenu-item.active {
            color: #8B0000;
            font-weight: 600;
        }

        /* MAIN CONTENT */
        .main-content {
            margin-left: 260px;
            padding: 20px 25px;
            margin-top: 100px;
            min-height: calc(100vh - 100px);
        }

        /* DASHBOARD HEADER */
        .dashboard-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            flex-wrap: wrap;
            gap: 15px;
            background: var(--white);
            padding: 12px 20px;
            border-radius: var(--border-radius);
            box-shadow: var(--shadow);
            border-left: 4px solid #8B0000;
        }

        .title-section h2 {
            font-size: 22px;
            color: var(--text-dark);
            font-weight: 700;
            margin-bottom: 3px;
        }

        .title-section p {
            color: var(--text-light);
            font-size: 13px;
        }

        .user-actions {
            display: flex;
            align-items: center;
            gap: 20px;
            flex-wrap: wrap;
        }

        .user-info {
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .user-details {
            text-align: right;
        }

        .user-details .name {
            font-weight: 700;
            font-size: 14px;
            color: #8B0000;
            display: block;
        }

        .user-details .role {
            font-size: 12px;
            color: var(--text-light);
        }

        .logout-btn {
            background: none;
            border: 1px solid var(--medium-gray);
            padding: 6px 12px;
            border-radius: var(--border-radius);
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 6px;
            color: var(--text-light);
            transition: var(--transition);
            font-size: 13px;
        }

        .logout-btn:hover {
            background: var(--light-gray);
            color: #8B0000;
            border-color: #8B0000;
        }

        .action-buttons {
            display: flex;
            gap: 10px;
        }

        .action-btn {
            padding: 8px 16px;
            border: none;
            border-radius: var(--border-radius);
            cursor: pointer;
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 6px;
            transition: var(--transition);
            font-size: 13px;
        }

        .action-btn.primary {
            background: #8B0000;
            color: white;
        }

        .action-btn.primary:hover {
            background: #5A0000;
            transform: translateY(-2px);
            box-shadow: var(--shadow);
        }

        .action-btn.secondary {
            background: #17a2b8;
            color: white;
        }

        .action-btn.secondary:hover {
            background: #138496;
            transform: translateY(-2px);
            box-shadow: var(--shadow);
        }

        /* CONTAINERS */
        .members-container, .documents-container, .document-detail-container {
            display: none;
        }

        .members-container.active, .documents-container.active, .document-detail-container.active {
            display: block;
        }

        .dashboard-container {
            display: none;
        }

        .dashboard-container.active {
            display: block;
        }

        /* STATS CARDS */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
            gap: 15px;
            margin-bottom: 25px;
        }

        .stat-card {
            background: var(--white);
            border-radius: var(--border-radius);
            padding: 18px;
            box-shadow: var(--shadow);
            transition: var(--transition);
            border-top: 4px solid #8B0000;
        }

        .stat-card:hover {
            transform: translateY(-3px);
            box-shadow: var(--shadow-lg);
        }

        .stat-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
        }

        .stat-icon {
            width: 45px;
            height: 45px;
            background: rgba(139, 0, 0, 0.1);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 20px;
            color: #8B0000;
        }

        .stat-trend {
            font-size: 12px;
            color: var(--success);
            font-weight: 600;
            padding: 3px 8px;
            border-radius: 15px;
            background: rgba(40, 167, 69, 0.1);
        }

        .stat-trend.negative {
            color: var(--danger);
            background: rgba(220, 53, 69, 0.1);
        }

        .stat-value {
            font-size: 26px;
            font-weight: 700;
            color: var(--text-dark);
            margin-bottom: 3px;
        }

        .stat-label {
            color: var(--text-light);
            font-size: 13px;
        }

        /* MODULES GRID */
        .modules-section {
            margin-bottom: 25px;
        }

        .section-title {
            font-size: 20px;
            color: var(--text-dark);
            margin-bottom: 15px;
            padding-bottom: 8px;
            border-bottom: 2px solid var(--medium-gray);
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .modules-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
            gap: 15px;
        }

        .module-card {
            background: var(--white);
            border-radius: var(--border-radius);
            padding: 18px;
            box-shadow: var(--shadow);
            transition: var(--transition);
            cursor: pointer;
            border: 1px solid var(--medium-gray);
        }

        .module-card:hover {
            transform: translateY(-3px);
            box-shadow: var(--shadow-lg);
            border-color: #A52A2A;
        }

        .module-card.featured {
            border-top: 4px solid #8B0000;
            background: linear-gradient(to bottom right, var(--white), rgba(139, 0, 0, 0.03));
        }

        .module-header {
            display: flex;
            align-items: center;
            gap: 12px;
            margin-bottom: 12px;
        }

        .module-icon {
            width: 45px;
            height: 45px;
            background: #8B0000;
            color: white;
            border-radius: var(--border-radius);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 20px;
        }

        .module-title {
            font-size: 16px;
            font-weight: 600;
            color: var(--text-dark);
        }

        .module-desc {
            color: var(--text-light);
            font-size: 13px;
            margin-bottom: 12px;
            line-height: 1.5;
        }

        .module-stats {
            display: flex;
            justify-content: space-between;
            font-size: 12px;
            color: var(--text-light);
        }

        /* ACTIVITY LIST */
        .activity-list {
            background: var(--white);
            border-radius: var(--border-radius);
            box-shadow: var(--shadow);
            overflow: hidden;
        }

        .activity-item {
            padding: 12px 18px;
            border-bottom: 1px solid var(--medium-gray);
            display: flex;
            align-items: center;
            gap: 12px;
            transition: var(--transition);
        }

        .activity-item:hover {
            background: var(--light-gray);
        }

        .activity-item:last-child {
            border-bottom: none;
        }

        .activity-icon {
            width: 36px;
            height: 36px;
            background: var(--light-gray);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: #8B0000;
            font-size: 14px;
        }

        .activity-content {
            flex: 1;
        }

        .activity-title {
            font-weight: 600;
            margin-bottom: 2px;
            color: var(--text-dark);
            font-size: 14px;
        }

        .activity-desc {
            color: var(--text-light);
            font-size: 13px;
        }

        .activity-time {
            color: var(--text-light);
            font-size: 12px;
            white-space: nowrap;
        }

        /* BADGE STYLES */
        .badge {
            display: inline-block;
            padding: 4px 10px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 600;
        }

        .badge-dinhky {
            background: #e3f2fd;
            color: #0d47a1;
        }

        .badge-chuyende {
            background: #f3e5f5;
            color: #4a148c;
        }

        .badge-quytrinh {
            background: #fff3e0;
            color: #e65100;
        }

        .badge-luutru {
            background: #e8f5e9;
            color: #1b5e20;
        }

        .badge-pheduyet {
            background: #ffebee;
            color: #b71c1c;
        }

        .badge-dangxuly {
            background: #fff9c4;
            color: #f57f17;
        }

        .badge-success {
            background: #e8f5e9;
            color: #2e7d32;
        }

        /* POSITION BADGES */
        .position-badge {
            display: inline-block;
            padding: 4px 10px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 600;
            margin: 2px 0;
            white-space: nowrap;
        }

        .badge-chinhquyen {
            background: #e3f2fd;
            color: #0d47a1;
            border: 1px solid #90caf9;
        }

        .badge-dang {
            background: #ffebee;
            color: #8B0000;
            border: 1px solid #ffcdd2;
        }

        .badge-congdoan {
            background: #fce4ec;
            color: #c2185b;
            border: 1px solid #f8bbd0;
        }

        .badge-doan {
            background: #e8f5e9;
            color: #2e7d32;
            border: 1px solid #a5d6a7;
        }

        /* TABLE STYLES */
        .table-container {
            background: var(--white);
            border-radius: var(--border-radius);
            box-shadow: var(--shadow);
            overflow: hidden;
            margin-top: 15px;
        }

        .table-header {
            padding: 15px 20px;
            border-bottom: 1px solid var(--medium-gray);
            display: flex;
            justify-content: space-between;
            align-items: center;
            background: var(--light-gray);
        }

        .table-title {
            font-size: 16px;
            font-weight: 700;
            color: var(--text-dark);
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .table-title i {
            color: #8B0000;
        }

        .table-controls {
            display: flex;
            gap: 12px;
            align-items: center;
        }

        .search-box {
            position: relative;
        }

        .search-input {
            padding: 8px 12px 8px 35px;
            border: 2px solid var(--medium-gray);
            border-radius: var(--border-radius);
            font-size: 13px;
            width: 220px;
            transition: var(--transition);
            background: var(--white);
            color: var(--text-dark);
        }

        .search-input:focus {
            outline: none;
            border-color: #8B0000;
        }

        .search-icon {
            position: absolute;
            left: 12px;
            top: 50%;
            transform: translateY(-50%);
            color: var(--text-light);
            font-size: 12px;
        }

        .table-wrapper {
            padding: 0;
            overflow-x: auto;
        }

        .members-table, .documents-table {
            width: 100%;
            border-collapse: collapse;
        }

        .members-table {
            min-width: 1300px;
        }

        .documents-table {
            min-width: 1200px;
        }

        .members-table thead, .documents-table thead {
            background: var(--light-gray);
        }

        .members-table th, .documents-table th {
            padding: 12px;
            text-align: left;
            font-weight: 600;
            color: var(--text-dark);
            border-bottom: 2px solid var(--medium-gray);
            font-size: 13px;
            text-transform: uppercase;
        }

        .members-table tbody tr, .documents-table tbody tr {
            border-bottom: 1px solid var(--medium-gray);
            transition: var(--transition);
        }

        .members-table tbody tr:hover, .documents-table tbody tr:hover {
            background: rgba(139, 0, 0, 0.03);
        }

        .members-table td, .documents-table td {
            padding: 10px 12px;
            font-size: 13px;
            vertical-align: middle;
            color: var(--text-dark);
        }

        .member-photo-cell {
            width: 60px;
            text-align: center;
        }

        .member-photo {
            width: 45px;
            height: 60px;
            border-radius: 4px;
            overflow: hidden;
            background: var(--light-gray);
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 0 auto;
            border: 1px solid var(--medium-gray);
            cursor: pointer;
            transition: var(--transition);
            position: relative;
        }

        .member-photo:hover {
            transform: scale(1.1);
            box-shadow: var(--shadow);
        }

        .member-photo img {
            width: 100%;
            height: 100%;
            object-fit: cover;
            display: block;
        }

        .member-photo .photo-placeholder {
            color: var(--text-light);
            padding: 5px;
            text-align: center;
            width: 100%;
            height: 100%;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
        }

        .member-photo .photo-placeholder i {
            font-size: 18px;
            margin-bottom: 3px;
        }

        .member-photo.has-image .photo-placeholder {
            display: none;
        }

        .member-name {
            font-weight: 600;
            color: var(--text-dark);
            font-size: 13px;
            margin-bottom: 2px;
        }

        .member-info {
            color: var(--text-light);
            font-size: 12px;
        }

        .document-title {
            font-weight: 600;
            color: var(--text-dark);
            margin-bottom: 2px;
            font-size: 13px;
        }

        .document-meta {
            color: var(--text-light);
            font-size: 12px;
        }

        .file-attachment {
            display: inline-flex;
            align-items: center;
            gap: 4px;
            padding: 3px 6px;
            background: var(--light-gray);
            border-radius: 4px;
            font-size: 11px;
            color: var(--text-light);
            border: 1px solid var(--medium-gray);
        }

        .file-attachment i {
            color: #8B0000;
        }

        .action-cell {
            display: flex;
            gap: 5px;
            justify-content: flex-start;
        }

        .action-btn-sm {
            width: 28px;
            height: 28px;
            border-radius: 4px;
            border: none;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: var(--transition);
            font-size: 12px;
        }

        .action-btn-sm.view {
            background: rgba(52, 152, 219, 0.1);
            color: #3498db;
        }

        .action-btn-sm.view:hover {
            background: #3498db;
            color: white;
        }

        .action-btn-sm.edit {
            background: rgba(46, 204, 113, 0.1);
            color: #2ecc71;
        }

        .action-btn-sm.edit:hover {
            background: #2ecc71;
            color: white;
        }

        .action-btn-sm.delete {
            background: rgba(231, 76, 60, 0.1);
            color: #e74c3c;
        }

        .action-btn-sm.delete:hover {
            background: #e74c3c;
            color: white;
        }

        .action-btn-sm.download {
            background: rgba(255, 193, 7, 0.1);
            color: #ffc107;
        }

        .action-btn-sm.download:hover {
            background: #ffc107;
            color: white;
        }

        .table-footer {
            padding: 12px 20px;
            border-top: 1px solid var(--medium-gray);
            display: flex;
            justify-content: space-between;
            align-items: center;
            background: var(--light-gray);
            font-size: 13px;
            color: var(--text-light);
        }

        .pagination {
            display: flex;
            gap: 5px;
        }

        .page-btn {
            width: 30px;
            height: 30px;
            border: 1px solid var(--medium-gray);
            background: var(--white);
            border-radius: 4px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: var(--transition);
            font-size: 12px;
            font-weight: 500;
            color: var(--text-dark);
        }

        .page-btn:hover {
            border-color: #8B0000;
            color: #8B0000;
        }

        .page-btn.active {
            background: #8B0000;
            color: white;
            border-color: #8B0000;
        }

        .page-btn.disabled {
            opacity: 0.5;
            cursor: not-allowed;
            background: var(--light-gray);
        }

        /* MODAL STYLES */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            display: none;
            justify-content: center;
            align-items: center;
            z-index: 1000;
            padding: 15px;
            backdrop-filter: blur(5px);
        }

        .modal-overlay.active {
            display: flex;
        }

        .modal-container {
            background: var(--white);
            border-radius: var(--border-radius);
            width: 100%;
            max-width: 800px;
            max-height: 90vh;
            overflow-y: auto;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
            animation: slideIn 0.3s ease;
        }

        @keyframes slideIn {
            from {
                transform: translateY(-30px);
                opacity: 0;
            }
            to {
                transform: translateY(0);
                opacity: 1;
            }
        }

        .modal-header {
            background: linear-gradient(135deg, #8B0000, #5A0000);
            color: white;
            padding: 15px 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            position: sticky;
            top: 0;
            z-index: 10;
            border-bottom: 2px solid #FFD700;
        }

        .modal-header h3 {
            font-size: 18px;
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 8px;
            color: #FFD700;
        }

        .close-modal {
            background: rgba(255, 215, 0, 0.2);
            border: none;
            width: 32px;
            height: 32px;
            border-radius: 50%;
            color: #FFD700;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: var(--transition);
        }

        .close-modal:hover {
            background: rgba(255, 215, 0, 0.3);
            transform: rotate(90deg);
        }

        .modal-body {
            padding: 20px;
        }

        .form-row {
            display: flex;
            gap: 15px;
            margin-bottom: 15px;
        }

        .form-col {
            flex: 1;
        }

        .form-group {
            margin-bottom: 15px;
        }

        .form-group label {
            display: block;
            margin-bottom: 5px;
            font-weight: 600;
            color: var(--text-dark);
            font-size: 13px;
        }

        .form-group label i {
            margin-right: 4px;
        }

        .form-control {
            width: 100%;
            padding: 10px;
            border: 2px solid var(--medium-gray);
            border-radius: var(--border-radius);
            font-size: 13px;
            transition: var(--transition);
            background: var(--white);
            color: var(--text-dark);
        }

        .form-control:focus {
            outline: none;
            border-color: #8B0000;
            box-shadow: 0 0 0 3px rgba(139, 0, 0, 0.1);
        }

        textarea.form-control {
            min-height: 100px;
            resize: vertical;
        }

        /* Photo upload styles */
        .photo-upload-container {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 10px;
            margin-bottom: 15px;
        }

        .photo-preview {
            width: 120px;
            height: 160px;
            border-radius: var(--border-radius);
            overflow: hidden;
            background: var(--light-gray);
            border: 2px dashed var(--medium-gray);
            display: flex;
            align-items: center;
            justify-content: center;
            position: relative;
            cursor: pointer;
            transition: var(--transition);
        }

        .photo-preview:hover {
            border-color: #8B0000;
            transform: scale(1.02);
        }

        .photo-preview.has-image {
            border: 2px solid #8B0000;
        }

        .photo-preview img {
            width: 100%;
            height: 100%;
            object-fit: cover;
            display: none;
        }

        .photo-preview.has-image img {
            display: block;
        }

        .photo-preview.has-image .photo-placeholder {
            display: none;
        }

        .photo-preview .photo-placeholder {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            color: var(--text-light);
            padding: 15px;
            text-align: center;
        }

        .photo-preview .photo-placeholder i {
            font-size: 35px;
            margin-bottom: 8px;
            color: var(--primary-red);
        }

        .upload-btn {
            padding: 8px 16px;
            background: #8B0000;
            color: white;
            border: none;
            border-radius: var(--border-radius);
            cursor: pointer;
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 6px;
            transition: var(--transition);
            font-size: 13px;
        }

        .upload-btn:hover {
            background: #5A0000;
        }

        .photo-actions {
            display: flex;
            gap: 8px;
            margin-top: 8px;
        }

        .photo-action-btn {
            padding: 5px 10px;
            border: none;
            border-radius: var(--border-radius);
            cursor: pointer;
            font-size: 12px;
            font-weight: 600;
            transition: var(--transition);
            display: flex;
            align-items: center;
            gap: 4px;
        }

        .photo-action-btn.remove {
            background: rgba(220, 53, 69, 0.1);
            color: var(--danger);
            border: 1px solid rgba(220, 53, 69, 0.3);
        }

        .photo-action-btn.remove:hover {
            background: rgba(220, 53, 69, 0.2);
        }

        .photo-info {
            font-size: 11px;
            color: var(--text-light);
            text-align: center;
        }

        /* File upload styles */
        .file-upload-container {
            border: 2px dashed var(--medium-gray);
            border-radius: var(--border-radius);
            padding: 15px;
            text-align: center;
            cursor: pointer;
            transition: var(--transition);
            margin-bottom: 12px;
        }

        .file-upload-container:hover {
            border-color: #8B0000;
            background: rgba(139, 0, 0, 0.02);
        }

        .file-upload-container i {
            font-size: 30px;
            color: #8B0000;
            margin-bottom: 8px;
        }

        .file-upload-container p {
            color: var(--text-light);
            margin-bottom: 3px;
            font-size: 13px;
        }

        .file-list {
            margin-top: 12px;
        }

        .file-item {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 8px 12px;
            background: var(--light-gray);
            border-radius: var(--border-radius);
            margin-bottom: 6px;
        }

        .file-item-info {
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .file-item-info i {
            color: #8B0000;
        }

        .file-item-name {
            font-weight: 500;
            font-size: 13px;
        }

        .file-item-size {
            font-size: 11px;
            color: var(--text-light);
            margin-left: 5px;
        }

        .file-item-remove {
            color: var(--danger);
            cursor: pointer;
            padding: 4px;
        }

        .file-item-remove:hover {
            background: rgba(220, 53, 69, 0.1);
            border-radius: 4px;
        }

        .modal-actions {
            display: flex;
            justify-content: flex-end;
            gap: 12px;
            padding-top: 15px;
            border-top: 1px solid var(--medium-gray);
            margin-top: 15px;
        }

        /* DOCUMENT DETAIL */
        .document-detail {
            background: var(--white);
            border-radius: var(--border-radius);
            box-shadow: var(--shadow);
            padding: 25px;
        }

        .document-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
            padding-bottom: 15px;
            border-bottom: 1px solid var(--medium-gray);
        }

        .document-header h2 {
            font-size: 20px;
            color: var(--text-dark);
        }

        .document-meta-info {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
            gap: 12px;
            margin-bottom: 20px;
            padding: 12px;
            background: var(--light-gray);
            border-radius: var(--border-radius);
        }

        .meta-item {
            display: flex;
            flex-direction: column;
        }

        .meta-label {
            font-size: 11px;
            color: var(--text-light);
            margin-bottom: 2px;
        }

        .meta-value {
            font-size: 13px;
            font-weight: 600;
            color: var(--text-dark);
        }

        .document-content {
            margin-bottom: 25px;
            line-height: 1.7;
        }

        .document-content h3 {
            font-size: 16px;
            margin-bottom: 12px;
            color: var(--text-dark);
        }

        .document-content p {
            margin-bottom: 12px;
            color: var(--text-dark);
            font-size: 14px;
        }

        .attachment-list {
            margin-top: 15px;
            border-top: 1px solid var(--medium-gray);
            padding-top: 15px;
        }

        .attachment-list h4 {
            font-size: 15px;
            margin-bottom: 12px;
            color: var(--text-dark);
        }

        .attachment-item {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 8px 12px;
            background: var(--light-gray);
            border-radius: var(--border-radius);
            margin-bottom: 8px;
        }

        .attachment-info {
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .attachment-info i {
            font-size: 18px;
            color: #8B0000;
        }

        .attachment-name {
            font-weight: 600;
            color: var(--text-dark);
            font-size: 13px;
        }

        .attachment-size {
            font-size: 11px;
            color: var(--text-light);
            margin-left: 8px;
        }

        .attachment-download {
            padding: 4px 10px;
            background: #8B0000;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 11px;
        }

        .attachment-download:hover {
            background: #5A0000;
        }

        /* FOOTER */
        .footer {
            margin-left: 260px;
            padding: 15px 25px;
            background: var(--white);
            border-top: 1px solid var(--medium-gray);
            color: var(--text-light);
            font-size: 13px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .footer-links {
            display: flex;
            gap: 15px;
        }

        .footer-links a {
            color: var(--text-light);
            text-decoration: none;
            transition: var(--transition);
            font-size: 13px;
        }

        .footer-links a:hover {
            color: #8B0000;
        }

        /* RESPONSIVE */
        @media (max-width: 1024px) {
            .sidebar {
                width: 220px;
            }
            .main-content, .footer {
                margin-left: 220px;
            }
            .logo-area {
                width: 220px;
            }
            .system-name h1 {
                font-size: 22px;
            }
        }

        @media (max-width: 768px) {
            .sidebar {
                width: 100%;
                position: relative;
                top: 0;
                display: none;
            }
            .sidebar.show {
                display: block;
            }
            .main-content, .footer {
                margin-left: 0;
            }
            .header {
                flex-direction: column;
                gap: 10px;
                padding: 10px;
                height: auto;
            }
            .logo-area {
                width: 100%;
                justify-content: center;
            }
            .system-name {
                margin: 5px 0;
                text-align: center;
            }
            .system-name h1 {
                font-size: 18px;
            }
            .system-name p {
                font-size: 12px;
            }
            .stats-grid {
                grid-template-columns: repeat(2, 1fr);
            }
            .modules-grid {
                grid-template-columns: 1fr;
            }
            .search-input {
                width: 180px;
            }
            .form-row {
                flex-direction: column;
            }
            .dashboard-header {
                flex-direction: column;
                align-items: flex-start;
            }
            .user-actions {
                width: 100%;
                flex-direction: column;
                align-items: flex-start;
                gap: 10px;
            }
            .user-info {
                width: 100%;
                justify-content: space-between;
            }
            .action-buttons {
                width: 100%;
                flex-direction: column;
            }
        }

        @media (max-width: 576px) {
            .stats-grid {
                grid-template-columns: 1fr;
            }
            .main-content {
                padding: 15px;
            }
            .table-controls {
                flex-direction: column;
                align-items: stretch;
            }
            .search-input {
                width: 100%;
            }
            .footer {
                flex-direction: column;
                gap: 10px;
                text-align: center;
            }
            .footer-links {
                flex-wrap: wrap;
                justify-content: center;
            }
        }
    </style>
</head>
<body>
    <!-- HEADER -->
    <header class="header">
        <div class="logo-area">
            <div class="flag-container" id="logoUpload">
                <div class="flag" id="flag"></div>
                <div class="logo-overlay">
                    <i class="fas fa-upload"></i> Tải lên logo
                </div>
            </div>
        </div>
        <div class="system-name">
            <h1>CHƯƠNG TRÌNH QUẢN LÝ CÔNG TÁC ĐẢNG</h1>
            <p>TRUNG TÂM KHAI THÁC KHU BAY NỘI BÀI</p>
        </div>
    </header>

    <!-- SIDEBAR -->
    <nav class="sidebar" id="sidebar">
        <div class="menu-section">
            <div class="menu-title">
                <i class="fas fa-bars"></i> Menu chính
            </div>
            <ul class="menu-list">
                <li>
                    <a href="#" class="menu-item" id="dashboardMenu">
                        <i class="fas fa-tachometer-alt"></i> Bảng điều khiển
                    </a>
                </li>
                <li>
                    <a href="#" class="menu-item" id="documentsMenuToggle">
                        <i class="fas fa-file-alt"></i> Quản lý Văn bản, Nghị quyết
                        <i class="fas fa-chevron-down" style="margin-left: auto; font-size: 11px;"></i>
                    </a>
                    <ul class="submenu" id="documentsSubmenu">
                        <li class="submenu-item" data-type="dinhky"><i class="fas fa-circle"></i> Nghị quyết định kỳ</li>
                        <li class="submenu-item" data-type="chuyende"><i class="fas fa-circle"></i> Nghị quyết chuyên đề</li>
                        <li class="submenu-item" data-type="quytrinh"><i class="fas fa-circle"></i> Quy trình xử lý</li>
                        <li class="submenu-item" data-type="luutru"><i class="fas fa-circle"></i> Kho lưu trữ</li>
                    </ul>
                </li>
                <li>
                    <a href="#" class="menu-item" id="membersMenuToggle">
                        <i class="fas fa-users"></i> Hồ sơ Đảng viên
                        <i class="fas fa-chevron-down" style="margin-left: auto; font-size: 11px;"></i>
                    </a>
                    <ul class="submenu" id="membersSubmenu">
                        <li class="submenu-item" data-branch="all"><i class="fas fa-globe"></i> Tất cả các chi bộ</li>
                        <li class="submenu-item" data-branch="VP"><i class="fas fa-building"></i> Văn phòng Trung tâm</li>
                        <li class="submenu-item" data-branch="BT"><i class="fas fa-road"></i> Đội Bảo trì Sân đường</li>
                        <li class="submenu-item" data-branch="MT"><i class="fas fa-leaf"></i> Đội Môi trường Khu bay</li>
                        <li class="submenu-item" data-branch="CD"><i class="fas fa-bolt"></i> Đội Thiết bị Cơ, Điện, Đèn</li>
                        <li class="submenu-item" data-branch="TT"><i class="fas fa-satellite-dish"></i> Đội Thông tin Dẫn đường</li>
                    </ul>
                </li>
                <li><a href="#" class="menu-item" id="shMenu"><i class="fas fa-calendar-check"></i> Sinh hoạt Đảng</a></li>
                <li><a href="#" class="menu-item" id="ptMenu"><i class="fas fa-chart-line"></i> Công tác Phát triển Đảng</a></li>
                <li><a href="#" class="menu-item" id="bcMenu"><i class="fas fa-chart-bar"></i> Báo cáo Thống kê</a></li>
                <li><a href="#" class="menu-item" id="htMenu"><i class="fas fa-cog"></i> Hệ thống</a></li>
            </ul>
        </div>
        
        <div class="menu-section">
            <div class="menu-title">
                <i class="fas fa-history"></i> Truy cập nhanh
            </div>
            <ul class="menu-list">
                <li><a href="#" class="menu-item" id="addMemberBtn"><i class="fas fa-plus-circle"></i> Thêm đảng viên mới</a></li>
                <li><a href="#" class="menu-item" id="addDocumentBtn"><i class="fas fa-file-alt"></i> Đăng văn bản mới</a></li>
                <li><a href="#" class="menu-item" id="pendingDocsBtn"><i class="fas fa-inbox"></i> Văn bản chờ xử lý</a></li>
                <li><a href="#" class="menu-item" id="docNotifications"><i class="fas fa-bell"></i> Thông báo văn bản</a></li>
            </ul>
        </div>
    </nav>

    <!-- MAIN CONTENT -->
    <main class="main-content">
        <!-- Dashboard Content -->
        <div class="dashboard-container active" id="dashboardContent">
            <div class="dashboard-header">
                <div class="title-section">
                    <h2>Bảng điều khiển</h2>
                    <p>Tổng quan và hoạt động mới nhất</p>
                </div>
                <div class="user-actions">
                    <div class="user-info">
                        <div class="user-details">
                            <span class="name">Nguyễn Văn Admin</span>
                            <span class="role">Quản trị viên</span>
                        </div>
                        <button class="logout-btn" id="logoutBtn">
                            <i class="fas fa-sign-out-alt"></i> Đăng xuất
                        </button>
                    </div>
                    <div class="action-buttons">
                        <button class="action-btn primary" id="createNewBtn"><i class="fas fa-plus"></i> Tạo mới</button>
                        <button class="action-btn secondary" id="exportReportBtn"><i class="fas fa-download"></i> Xuất báo cáo</button>
                    </div>
                </div>
            </div>

            <div class="stats-grid">
                <div class="stat-card">
                    <div class="stat-header">
                        <div class="stat-icon"><i class="fas fa-file-alt"></i></div>
                        <div class="stat-trend"><i class="fas fa-arrow-up"></i> 12.5%</div>
                    </div>
                    <div class="stat-value" id="totalDocuments">0</div>
                    <div class="stat-label">Tổng số văn bản</div>
                </div>
                <div class="stat-card">
                    <div class="stat-header">
                        <div class="stat-icon"><i class="fas fa-calendar-check"></i></div>
                        <div class="stat-trend"><i class="fas fa-arrow-up"></i> 8.3%</div>
                    </div>
                    <div class="stat-value" id="dinhkyDocs">0</div>
                    <div class="stat-label">Nghị quyết định kỳ</div>
                </div>
                <div class="stat-card">
                    <div class="stat-header">
                        <div class="stat-icon"><i class="fas fa-star"></i></div>
                        <div class="stat-trend"><i class="fas fa-minus"></i> 0%</div>
                    </div>
                    <div class="stat-value" id="chuyendeDocs">0</div>
                    <div class="stat-label">Nghị quyết chuyên đề</div>
                </div>
                <div class="stat-card">
                    <div class="stat-header">
                        <div class="stat-icon"><i class="fas fa-hourglass-half"></i></div>
                        <div class="stat-trend negative"><i class="fas fa-arrow-down"></i> 5.2%</div>
                    </div>
                    <div class="stat-value" id="pendingDocs">0</div>
                    <div class="stat-label">Chờ phê duyệt</div>
                </div>
            </div>

            <div class="modules-section">
                <h3 class="section-title"><i class="fas fa-th-large"></i> Các chức năng chính</h3>
                <div class="modules-grid">
                    <div class="module-card featured" id="goToDocuments">
                        <div class="module-header">
                            <div class="module-icon"><i class="fas fa-file-alt"></i></div>
                            <div>
                                <div class="module-title">Quản lý Văn bản, Nghị quyết</div>
                                <div class="module-stats"><span id="moduleDocStats">0 văn bản</span> <span>0 chờ duyệt</span></div>
                            </div>
                        </div>
                        <p class="module-desc">Quản lý toàn bộ văn bản, nghị quyết từ dự thảo đến ban hành. Hỗ trợ đính kèm file.</p>
                    </div>
                    <div class="module-card" id="goToMembers">
                        <div class="module-header">
                            <div class="module-icon"><i class="fas fa-users"></i></div>
                            <div>
                                <div class="module-title">Hồ sơ Đảng viên</div>
                                <div class="module-stats"><span id="memberStats">0 đảng viên</span> <span>0 mới</span></div>
                            </div>
                        </div>
                        <p class="module-desc">Quản lý thông tin, quá trình công tác, khen thưởng, kỷ luật của đảng viên.</p>
                    </div>
                    <div class="module-card" id="goToSh">
                        <div class="module-header">
                            <div class="module-icon"><i class="fas fa-calendar-check"></i></div>
                            <div>
                                <div class="module-title">Sinh hoạt Đảng</div>
                                <div class="module-stats"><span>4 cuộc họp</span> <span>8 bài học</span></div>
                            </div>
                        </div>
                        <p class="module-desc">Lập kế hoạch, theo dõi sinh hoạt chi bộ và quản lý nội dung học tập.</p>
                    </div>
                </div>
            </div>

            <div class="modules-section">
                <h3 class="section-title"><i class="fas fa-history"></i> Hoạt động gần đây</h3>
                <div class="activity-list" id="dashboardActivityList">
                    <div class="activity-item">
                        <div class="activity-icon"><i class="fas fa-info-circle"></i></div>
                        <div class="activity-content">
                            <div class="activity-title">Chào mừng bạn đến với hệ thống</div>
                            <div class="activity-desc">Quản lý công tác Đảng phiên bản 2.0</div>
                        </div>
                        <div class="activity-time">Bây giờ</div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Documents List Content -->
        <div class="documents-container" id="documentsContent">
            <div class="dashboard-header">
                <div class="title-section">
                    <h2 id="documentsPageTitle">QUẢN LÝ VĂN BẢN, NGHỊ QUYẾT</h2>
                    <p id="documentsPageSubtitle">Danh sách văn bản</p>
                </div>
                <div class="action-buttons">
                    <button class="action-btn primary" id="addNewDocumentBtn"><i class="fas fa-plus-circle"></i> Đăng văn bản mới</button>
                    <button class="action-btn secondary" id="exportDocsBtn"><i class="fas fa-file-export"></i> Xuất danh sách</button>
                </div>
            </div>

            <div class="table-container">
                <div class="table-header">
                    <div class="table-title">
                        <i class="fas fa-list"></i>
                        <span id="documentTableTitle">DANH SÁCH VĂN BẢN</span>
                    </div>
                    <div class="table-controls">
                        <div class="search-box">
                            <i class="fas fa-search search-icon"></i>
                            <input type="text" class="search-input" id="searchDocument" placeholder="Tìm kiếm văn bản...">
                        </div>
                        <select class="form-control" id="docTypeFilter" style="width: 130px;">
                            <option value="all">Tất cả</option>
                            <option value="dinhky">Định kỳ</option>
                            <option value="chuyende">Chuyên đề</option>
                            <option value="quytrinh">Quy trình</option>
                            <option value="luutru">Lưu trữ</option>
                        </select>
                    </div>
                </div>
                <div class="table-wrapper">
                    <table class="documents-table" id="documentsTable">
                        <thead>
                            <tr>
                                <th>Số hiệu</th>
                                <th>Tiêu đề</th>
                                <th>Loại</th>
                                <th>Ngày ban hành</th>
                                <th>Người ký</th>
                                <th>File</th>
                                <th>Trạng thái</th>
                                <th>Thao tác</th>
                            </tr>
                        </thead>
                        <tbody id="documentsTableBody">
                            <!-- Dữ liệu sẽ được load bằng JavaScript -->
                        </tbody>
                    </table>
                </div>
                <div class="table-footer">
                    <div id="documentTableInfo">Hiển thị 0 văn bản</div>
                    <div class="pagination">
                        <button class="page-btn disabled" id="docPrevPage"><i class="fas fa-chevron-left"></i></button>
                        <span id="docPaginationButtons"></span>
                        <button class="page-btn disabled" id="docNextPage"><i class="fas fa-chevron-right"></i></button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Members List Content -->
        <div class="members-container" id="membersContent">
            <div class="dashboard-header">
                <div class="title-section">
                    <h2 id="membersPageTitle">DANH SÁCH ĐẢNG VIÊN</h2>
                    <p id="membersPageSubtitle">Quản lý thông tin đảng viên toàn diện</p>
                </div>
                <div class="action-buttons">
                    <button class="action-btn primary" id="addNewMemberBtn"><i class="fas fa-plus-circle"></i> Thêm đảng viên</button>
                    <button class="action-btn secondary" id="exportMembersBtn"><i class="fas fa-file-export"></i> Xuất danh sách</button>
                </div>
            </div>

            <div class="table-container">
                <div class="table-header">
                    <div class="table-title">
                        <i class="fas fa-list"></i>
                        <span id="tableTitle">DANH SÁCH ĐẢNG VIÊN</span>
                    </div>
                    <div class="table-controls">
                        <div class="search-box">
                            <i class="fas fa-search search-icon"></i>
                            <input type="text" class="search-input" id="searchMember" placeholder="Tìm kiếm...">
                        </div>
                    </div>
                </div>
                <div class="table-wrapper">
                    <table class="members-table" id="membersTable">
                        <thead>
                            <tr>
                                <th>STT</th>
                                <th>Ảnh</th>
                                <th>Họ tên</th>
                                <th>Chính quyền</th>
                                <th>Đảng</th>
                                <th>Công đoàn</th>
                                <th>Đoàn TN</th>
                                <th>Chi bộ</th>
                                <th>Thao tác</th>
                            </tr>
                        </thead>
                        <tbody id="membersTableBody">
                            <!-- Dữ liệu sẽ được load bằng JavaScript -->
                        </tbody>
                    </table>
                </div>
                <div class="table-footer">
                    <div id="tableInfo">Hiển thị 0 đảng viên</div>
                    <div class="pagination">
                        <button class="page-btn disabled" id="prevPage"><i class="fas fa-chevron-left"></i></button>
                        <span id="paginationButtons"></span>
                        <button class="page-btn disabled" id="nextPage"><i class="fas fa-chevron-right"></i></button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Document Detail Content -->
        <div class="document-detail-container" id="documentDetailContent"></div>
    </main>

    <!-- FOOTER -->
    <footer class="footer">
        <div class="footer-copyright">© 2026 Chương trình Quản lý Công tác Đảng. Phiên bản 2.0</div>
        <div class="footer-links">
            <a href="#" id="helpLink">Trợ giúp</a>
            <a href="#" id="guideLink">Hướng dẫn</a>
            <a href="#" id="contactLink">Liên hệ</a>
            <a href="#" id="policyLink">Bảo mật</a>
        </div>
    </footer>

    <!-- MODAL THÊM/SỬA ĐẢNG VIÊN -->
    <div class="modal-overlay" id="memberModal">
        <div class="modal-container">
            <div class="modal-header">
                <h3 id="modalTitle"><i class="fas fa-user-plus"></i> THÊM ĐẢNG VIÊN MỚI</h3>
                <button class="close-modal" onclick="closeMemberModal()"><i class="fas fa-times"></i></button>
            </div>
            <div class="modal-body">
                <!-- Upload ảnh -->
                <div class="photo-upload-container">
                    <div class="photo-preview" id="photoPreview" onclick="document.getElementById('photoUpload').click()">
                        <div class="photo-placeholder">
                            <i class="fas fa-camera"></i>
                            <span>Chọn ảnh</span>
                        </div>
                        <img id="photoImage" src="#" alt="Preview">
                    </div>
                    <input type="file" id="photoUpload" accept="image/jpeg,image/png,image/jpg" style="display: none;">
                    <div class="photo-actions">
                        <button class="upload-btn" onclick="document.getElementById('photoUpload').click()">
                            <i class="fas fa-upload"></i> Chọn ảnh
                        </button>
                        <button class="photo-action-btn remove" onclick="removePhoto()">
                            <i class="fas fa-trash"></i> Xóa
                        </button>
                    </div>
                    <div class="photo-info" id="photoInfo">
                        <i class="fas fa-info-circle"></i> JPG, PNG (tối đa 2MB)
                    </div>
                </div>

                <div class="form-row">
                    <div class="form-col">
                        <div class="form-group">
                            <label>Họ và tên <span style="color: red;">*</span></label>
                            <input type="text" class="form-control" id="memberName" placeholder="Nhập họ và tên">
                        </div>
                    </div>
                    <div class="form-col">
                        <div class="form-group">
                            <label>Ngày sinh</label>
                            <input type="date" class="form-control" id="memberDob">
                        </div>
                    </div>
                </div>

                <div class="form-row">
                    <div class="form-col">
                        <div class="form-group">
                            <label><i class="fas fa-building" style="color: #2196F3;"></i> Chức vụ Chính quyền</label>
                            <select class="form-control" id="memberChinhquyen">
                                <option value="">-- Chọn chức vụ --</option>
                                <option>Giám đốc</option>
                                <option>Phó Giám đốc</option>
                                <option>Trưởng phòng</option>
                                <option>Phó Trưởng phòng</option>
                                <option>Đội trưởng</option>
                                <option>Đội phó</option>
                                <option>Chuyên viên</option>
                                <option>Nhân viên</option>
                            </select>
                        </div>
                    </div>
                    <div class="form-col">
                        <div class="form-group">
                            <label><i class="fas fa-star" style="color: #8B0000;"></i> Chức vụ Đảng</label>
                            <select class="form-control" id="memberDang">
                                <option value="">-- Chọn chức vụ --</option>
                                <option>Bí thư Đảng ủy</option>
                                <option>Phó Bí thư Đảng ủy</option>
                                <option>Ủy viên Ban Thường vụ</option>
                                <option>Bí thư Chi bộ</option>
                                <option>Phó Bí thư Chi bộ</option>
                                <option>Chi ủy viên</option>
                                <option>Đảng viên</option>
                            </select>
                        </div>
                    </div>
                </div>

                <div class="form-row">
                    <div class="form-col">
                        <div class="form-group">
                            <label><i class="fas fa-users" style="color: #E91E63;"></i> Chức vụ Công đoàn</label>
                            <select class="form-control" id="memberCongdoan">
                                <option value="">-- Chọn chức vụ --</option>
                                <option>Chủ tịch Công đoàn</option>
                                <option>Phó Chủ tịch Công đoàn</option>
                                <option>Ủy viên BCH Công đoàn</option>
                                <option>Tổ trưởng Công đoàn</option>
                                <option>Trưởng ban Nữ công</option>
                                <option>Đoàn viên công đoàn</option>
                            </select>
                        </div>
                    </div>
                    <div class="form-col">
                        <div class="form-group">
                            <label><i class="fas fa-leaf" style="color: #4CAF50;"></i> Chức vụ Đoàn Thanh niên</label>
                            <select class="form-control" id="memberDoan">
                                <option value="">-- Chọn chức vụ --</option>
                                <option>Bí thư Đoàn</option>
                                <option>Phó Bí thư Đoàn</option>
                                <option>Ủy viên BCH Đoàn</option>
                                <option>Bí thư Chi đoàn</option>
                                <option>Đoàn viên</option>
                            </select>
                        </div>
                    </div>
                </div>

                <div class="form-row">
                    <div class="form-col">
                        <div class="form-group">
                            <label>Chi bộ</label>
                            <select class="form-control" id="memberBranch">
                                <option>Văn phòng Trung tâm</option>
                                <option>Đội Bảo trì Sân đường</option>
                                <option>Đội Môi trường Khu bay</option>
                                <option>Đội Thiết bị Cơ, Điện, Đèn</option>
                                <option>Đội Thông tin Dẫn đường</option>
                            </select>
                        </div>
                    </div>
                    <div class="form-col">
                        <div class="form-group">
                            <label>Ngày vào Đảng</label>
                            <input type="date" class="form-control" id="memberPartyDate">
                        </div>
                    </div>
                </div>

                <div class="modal-actions">
                    <button class="action-btn secondary" onclick="closeMemberModal()">Hủy</button>
                    <button class="action-btn primary" onclick="saveMember()">Lưu thông tin</button>
                </div>
            </div>
        </div>
    </div>

    <!-- MODAL THÊM/SỬA VĂN BẢN -->
    <div class="modal-overlay" id="documentModal">
        <div class="modal-container">
            <div class="modal-header">
                <h3 id="documentModalTitle"><i class="fas fa-file-alt"></i> ĐĂNG VĂN BẢN MỚI</h3>
                <button class="close-modal" onclick="closeDocumentModal()"><i class="fas fa-times"></i></button>
            </div>
            <div class="modal-body">
                <div class="form-row">
                    <div class="form-col">
                        <div class="form-group">
                            <label>Số hiệu <span style="color: red;">*</span></label>
                            <input type="text" class="form-control" id="docSoHieu" placeholder="VD: 01/NQ-ĐU">
                        </div>
                    </div>
                    <div class="form-col">
                        <div class="form-group">
                            <label>Loại văn bản</label>
                            <select class="form-control" id="docLoai">
                                <option value="dinhky">Nghị quyết định kỳ</option>
                                <option value="chuyende">Nghị quyết chuyên đề</option>
                                <option value="quytrinh">Quy trình xử lý</option>
                                <option value="luutru">Kho lưu trữ</option>
                            </select>
                        </div>
                    </div>
                </div>

                <div class="form-group">
                    <label>Tiêu đề <span style="color: red;">*</span></label>
                    <input type="text" class="form-control" id="docTieuDe" placeholder="Nhập tiêu đề văn bản">
                </div>

                <div class="form-row">
                    <div class="form-col">
                        <div class="form-group">
                            <label>Ngày ban hành</label>
                            <input type="date" class="form-control" id="docNgayBanHanh">
                        </div>
                    </div>
                    <div class="form-col">
                        <div class="form-group">
                            <label>Người ký</label>
                            <input type="text" class="form-control" id="docNguoiKy" placeholder="Họ tên người ký">
                        </div>
                    </div>
                </div>

                <div class="form-group">
                    <label>Trích yếu</label>
                    <textarea class="form-control" id="docNoiDung" placeholder="Nội dung tóm tắt..."></textarea>
                </div>

                <div class="form-group">
                    <label>Nội dung chi tiết</label>
                    <textarea class="form-control" id="docNoiDungChiTiet" placeholder="Nội dung chi tiết..." style="min-height: 150px;"></textarea>
                </div>

                <div class="form-group">
                    <label><i class="fas fa-paperclip"></i> File đính kèm</label>
                    <div class="file-upload-container" onclick="document.getElementById('fileUpload').click()">
                        <i class="fas fa-cloud-upload-alt"></i>
                        <p>Click để chọn file</p>
                        <p style="font-size: 11px;">PDF, DOC, XLS, JPG (tối đa 20MB)</p>
                    </div>
                    <input type="file" id="fileUpload" multiple style="display: none;" accept=".pdf,.doc,.docx,.xls,.xlsx,.jpg,.jpeg,.png">
                    <div class="file-list" id="fileList"></div>
                </div>

                <div class="form-row">
                    <div class="form-col">
                        <div class="form-group">
                            <label>Trạng thái</label>
                            <select class="form-control" id="docTrangThai">
                                <option value="banhanh">Đã ban hành</option>
                                <option value="chopheduyet">Chờ phê duyệt</option>
                                <option value="dangxuly">Đang xử lý</option>
                                <option value="luutru">Lưu trữ</option>
                            </select>
                        </div>
                    </div>
                </div>

                <div class="modal-actions">
                    <button class="action-btn secondary" onclick="closeDocumentModal()">Hủy</button>
                    <button class="action-btn primary" onclick="saveDocument()">Lưu văn bản</button>
                </div>
            </div>
        </div>
    </div>

    <script>
        // ===== CẤU HÌNH =====
        const API_URL = ''; // Để trống nếu chưa có backend

        // ===== BIẾN TOÀN CỤC =====
        let currentMemberId = null;
        let currentDocumentId = null;
        let currentPhotoFile = null;
        let currentPhotoData = null;
        let currentFiles = [];
        let currentDocType = 'dinhky';
        let currentBranch = 'all';
        let members = [];
        let documents = [];

        // ===== KHỞI TẠO =====
        document.addEventListener('DOMContentLoaded', function() {
            console.log('Trang đã sẵn sàng');
            initEventListeners();
            loadSavedLogo(); // Tải logo đã lưu
            showDashboard();
            loadSampleData(); // Tải dữ liệu mẫu
        });

        // ===== INIT EVENT LISTENERS =====
        function initEventListeners() {
            // Logo upload
            document.getElementById('logoUpload').addEventListener('click', handleLogoUpload);

            // Menu toggle
            document.getElementById('documentsMenuToggle').addEventListener('click', function(e) {
                e.preventDefault();
                document.getElementById('documentsSubmenu').classList.toggle('show');
            });

            document.getElementById('membersMenuToggle').addEventListener('click', function(e) {
                e.preventDefault();
                document.getElementById('membersSubmenu').classList.toggle('show');
            });

            // Main menu items
            document.getElementById('dashboardMenu').addEventListener('click', function(e) {
                e.preventDefault();
                showDashboard();
            });

            // Documents submenu
            document.querySelectorAll('#documentsSubmenu .submenu-item').forEach(item => {
                item.addEventListener('click', function(e) {
                    e.preventDefault();
                    e.stopPropagation();
                    const type = this.getAttribute('data-type');
                    if (type) {
                        setActiveDocumentType(this, type);
                    }
                });
            });

            // Members submenu
            document.querySelectorAll('#membersSubmenu .submenu-item').forEach(item => {
                item.addEventListener('click', function(e) {
                    e.preventDefault();
                    e.stopPropagation();
                    const branch = this.getAttribute('data-branch');
                    if (branch) {
                        setActiveMemberBranch(this, branch);
                    }
                });
            });

            // Other menu items
            document.getElementById('shMenu').addEventListener('click', (e) => {
                e.preventDefault();
                alert('Chức năng Sinh hoạt Đảng đang phát triển');
            });

            document.getElementById('ptMenu').addEventListener('click', (e) => {
                e.preventDefault();
                alert('Chức năng Công tác Phát triển Đảng đang phát triển');
            });

            document.getElementById('bcMenu').addEventListener('click', (e) => {
                e.preventDefault();
                alert('Chức năng Báo cáo Thống kê đang phát triển');
            });

            document.getElementById('htMenu').addEventListener('click', (e) => {
                e.preventDefault();
                alert('Chức năng Hệ thống đang phát triển');
            });

            // Quick access
            document.getElementById('addMemberBtn').addEventListener('click', (e) => {
                e.preventDefault();
                showMembers();
                openAddMemberModal();
            });

            document.getElementById('addDocumentBtn').addEventListener('click', (e) => {
                e.preventDefault();
                showDocuments();
                openAddDocumentModal();
            });

            document.getElementById('pendingDocsBtn').addEventListener('click', (e) => {
                e.preventDefault();
                showDocuments();
                filterDocumentsByStatus('chopheduyet');
            });

            document.getElementById('docNotifications').addEventListener('click', (e) => {
                e.preventDefault();
                alert('Có 2 văn bản mới cần xử lý');
            });

            // Action buttons
            document.getElementById('createNewBtn').addEventListener('click', () => {
                openAddDocumentModal();
            });

            document.getElementById('exportReportBtn').addEventListener('click', () => {
                alert('Chức năng Xuất báo cáo đang phát triển');
            });

            document.getElementById('addNewMemberBtn').addEventListener('click', () => {
                openAddMemberModal();
            });

            document.getElementById('addNewDocumentBtn').addEventListener('click', () => {
                openAddDocumentModal();
            });

            document.getElementById('exportMembersBtn').addEventListener('click', () => {
                alert('Chức năng Xuất danh sách đảng viên đang phát triển');
            });

            document.getElementById('exportDocsBtn').addEventListener('click', () => {
                alert('Chức năng Xuất danh sách văn bản đang phát triển');
            });

            // Module cards
            document.getElementById('goToDocuments').addEventListener('click', () => {
                showDocuments();
            });

            document.getElementById('goToMembers').addEventListener('click', () => {
                showMembers();
            });

            document.getElementById('goToSh').addEventListener('click', () => {
                alert('Chức năng Sinh hoạt Đảng đang phát triển');
            });

            // Logout
            document.getElementById('logoutBtn').addEventListener('click', () => {
                if (confirm('Bạn có chắc chắn muốn đăng xuất?')) {
                    alert('Đã đăng xuất');
                }
            });

            // Footer links
            document.getElementById('helpLink').addEventListener('click', (e) => {
                e.preventDefault();
                alert('Chức năng Trợ giúp đang phát triển');
            });

            document.getElementById('guideLink').addEventListener('click', (e) => {
                e.preventDefault();
                alert('Chức năng Hướng dẫn sử dụng đang phát triển');
            });

            document.getElementById('contactLink').addEventListener('click', (e) => {
                e.preventDefault();
                alert('Chức năng Liên hệ đang phát triển');
            });

            document.getElementById('policyLink').addEventListener('click', (e) => {
                e.preventDefault();
                alert('Chức năng Chính sách bảo mật đang phát triển');
            });

            // File upload
            document.getElementById('photoUpload').addEventListener('change', handlePhotoUpload);
            document.getElementById('fileUpload').addEventListener('change', handleFileUpload);

            // Search
            document.getElementById('searchMember').addEventListener('keyup', debounce(handleMemberSearch, 500));
            document.getElementById('searchDocument').addEventListener('keyup', debounce(handleDocumentSearch, 500));

            // Filter
            document.getElementById('docTypeFilter').addEventListener('change', handleDocTypeFilter);

            // Close modal when clicking outside
            window.addEventListener('click', (e) => {
                const memberModal = document.getElementById('memberModal');
                const docModal = document.getElementById('documentModal');
                if (e.target === memberModal) closeMemberModal();
                if (e.target === docModal) closeDocumentModal();
            });
        }

        // ===== LOGO UPLOAD - LƯU VÀO LOCALSTORAGE =====
        function handleLogoUpload() {
            const fileInput = document.createElement('input');
            fileInput.type = 'file';
            fileInput.accept = 'image/*';
            
            fileInput.addEventListener('change', function(e) {
                const file = e.target.files[0];
                if (file) {
                    if (file.size > 2 * 1024 * 1024) {
                        alert('Logo không được vượt quá 2MB');
                        return;
                    }

                    const reader = new FileReader();
                    reader.onload = function(event) {
                        const imageData = event.target.result;
                        
                        try {
                            localStorage.setItem('partyLogo', imageData);
                            applyLogo(imageData);
                            alert('Đã lưu logo thành công!');
                        } catch (e) {
                            alert('Không thể lưu logo. Có thể file quá lớn.');
                        }
                    };
                    reader.readAsDataURL(file);
                }
            });
            
            fileInput.click();
        }

        function loadSavedLogo() {
            const savedLogo = localStorage.getItem('partyLogo');
            if (savedLogo) {
                applyLogo(savedLogo);
            }
        }

        function applyLogo(imageData) {
            const flagContainer = document.getElementById('logoUpload');
            const existingImg = flagContainer.querySelector('img');
            
            if (existingImg) {
                existingImg.src = imageData;
            } else {
                const logoImg = document.createElement('img');
                logoImg.src = imageData;
                logoImg.style.width = '100%';
                logoImg.style.height = '100%';
                logoImg.style.objectFit = 'contain';
                
                flagContainer.innerHTML = '';
                flagContainer.appendChild(logoImg);
                flagContainer.classList.add('has-logo');
                
                const overlay = document.createElement('div');
                overlay.className = 'logo-overlay';
                overlay.innerHTML = '<i class="fas fa-upload"></i> Thay đổi logo';
                flagContainer.appendChild(overlay);
            }
        }

        // ===== MENU FUNCTIONS =====
        function setActiveDocumentType(element, type) {
            document.querySelectorAll('#documentsSubmenu .submenu-item').forEach(i => {
                i.classList.remove('active');
            });
            element.classList.add('active');
            
            currentDocType = type;

            const titles = {
                'dinhky': { title: 'NGHỊ QUYẾT ĐỊNH KỲ', subtitle: 'Các nghị quyết định kỳ của Đảng ủy' },
                'chuyende': { title: 'NGHỊ QUYẾT CHUYÊN ĐỀ', subtitle: 'Các nghị quyết chuyên đề' },
                'quytrinh': { title: 'QUY TRÌNH XỬ LÝ', subtitle: 'Các quy trình, hướng dẫn nghiệp vụ' },
                'luutru': { title: 'KHO LƯU TRỮ', subtitle: 'Các văn bản đã lưu trữ' }
            };

            document.getElementById('documentsPageTitle').innerText = 'QUẢN LÝ VĂN BẢN, NGHỊ QUYẾT';
            document.getElementById('documentsPageSubtitle').innerText = titles[type]?.subtitle || '';
            document.getElementById('documentTableTitle').innerText = 'DANH SÁCH ' + (titles[type]?.title || '');

            filterDocumentsByType(type);
            showDocuments();
        }

        function setActiveMemberBranch(element, branch) {
            document.querySelectorAll('#membersSubmenu .submenu-item').forEach(i => {
                i.classList.remove('active');
            });
            element.classList.add('active');

            currentBranch = branch;

            const branchName = branch === 'all' ? 'TẤT CẢ CHI BỘ' : element.textContent.trim().toUpperCase();
            document.getElementById('membersPageTitle').innerText = 'DANH SÁCH ĐẢNG VIÊN';
            document.getElementById('membersPageSubtitle').innerText = branch === 'all' ? 'Tất cả các chi bộ' : element.textContent.trim();
            document.getElementById('tableTitle').innerText = 'DANH SÁCH ĐẢNG VIÊN - ' + branchName;

            filterMembersByBranch(branch);
            showMembers();
        }

        // ===== PAGE NAVIGATION =====
        function showDashboard() {
            document.getElementById('dashboardContent').classList.add('active');
            document.getElementById('membersContent').classList.remove('active');
            document.getElementById('documentsContent').classList.remove('active');
            document.getElementById('documentDetailContent').classList.remove('active');

            document.querySelectorAll('.menu-item').forEach(item => item.classList.remove('active'));
            document.getElementById('dashboardMenu').classList.add('active');
        }

        function showMembers() {
            document.getElementById('membersContent').classList.add('active');
            document.getElementById('dashboardContent').classList.remove('active');
            document.getElementById('documentsContent').classList.remove('active');
            document.getElementById('documentDetailContent').classList.remove('active');

            document.querySelectorAll('.menu-item').forEach(item => item.classList.remove('active'));
            document.getElementById('membersMenuToggle').classList.add('active');
        }

        function showDocuments() {
            document.getElementById('documentsContent').classList.add('active');
            document.getElementById('dashboardContent').classList.remove('active');
            document.getElementById('membersContent').classList.remove('active');
            document.getElementById('documentDetailContent').classList.remove('active');

            document.querySelectorAll('.menu-item').forEach(item => item.classList.remove('active'));
            document.getElementById('documentsMenuToggle').classList.add('active');
        }

        function showDocumentDetail(id) {
            const doc = documents.find(d => d.id === id);
            if (!doc) return;

            const detailContainer = document.getElementById('documentDetailContent');
            
            const ngay = doc.ngaybanhanh ? new Date(doc.ngaybanhanh).toLocaleDateString('vi-VN') : 'Chưa có';
            
            const loaiText = {
                'dinhky': 'Nghị quyết định kỳ',
                'chuyende': 'Nghị quyết chuyên đề',
                'quytrinh': 'Quy trình xử lý',
                'luutru': 'Kho lưu trữ'
            };
            
            const loaiClass = {
                'dinhky': 'badge-dinhky',
                'chuyende': 'badge-chuyende',
                'quytrinh': 'badge-quytrinh',
                'luutru': 'badge-luutru'
            };
            
            const trangthaiText = {
                'banhanh': 'Đã ban hành',
                'chopheduyet': 'Chờ phê duyệt',
                'dangxuly': 'Đang xử lý',
                'luutru': 'Lưu trữ'
            };
            
            let filesHtml = '';
            if (doc.files && doc.files.length > 0) {
                filesHtml = '<div class="attachment-list"><h4><i class="fas fa-paperclip"></i> File đính kèm</h4>';
                doc.files.forEach(file => {
                    const size = formatFileSize(file.size);
                    filesHtml += `
                        <div class="attachment-item">
                            <div class="attachment-info">
                                <i class="fas ${getFileIcon(file.type)}"></i>
                                <div>
                                    <span class="attachment-name">${file.name}</span>
                                    <span class="attachment-size">${size}</span>
                                </div>
                            </div>
                            <button class="attachment-download" onclick="downloadFile('${file.name}')">
                                <i class="fas fa-download"></i> Tải về
                            </button>
                        </div>
                    `;
                });
                filesHtml += '</div>';
            }
            
            detailContainer.innerHTML = `
                <div class="dashboard-header">
                    <div class="title-section">
                        <h2>CHI TIẾT VĂN BẢN</h2>
                        <p>${doc.tieude}</p>
                    </div>
                    <div class="action-buttons">
                        <button class="action-btn secondary" onclick="showDocuments()">
                            <i class="fas fa-arrow-left"></i> Quay lại
                        </button>
                        <button class="action-btn primary" onclick="editDocument(${doc.id})">
                            <i class="fas fa-edit"></i> Chỉnh sửa
                        </button>
                    </div>
                </div>
                
                <div class="document-detail">
                    <div class="document-header">
                        <h2>${doc.tieude}</h2>
                        <span class="badge ${loaiClass[doc.loai]}" style="padding: 6px 12px;">${loaiText[doc.loai]}</span>
                    </div>
                    
                    <div class="document-meta-info">
                        <div class="meta-item">
                            <span class="meta-label">Số hiệu</span>
                            <span class="meta-value">${doc.sohieu}</span>
                        </div>
                        <div class="meta-item">
                            <span class="meta-label">Ngày ban hành</span>
                            <span class="meta-value">${ngay}</span>
                        </div>
                        <div class="meta-item">
                            <span class="meta-label">Người ký</span>
                            <span class="meta-value">${doc.nguoiky || 'Chưa có'}</span>
                        </div>
                        <div class="meta-item">
                            <span class="meta-label">Trạng thái</span>
                            <span class="meta-value">${trangthaiText[doc.trangthai] || ''}</span>
                        </div>
                    </div>
                    
                    <div class="document-content">
                        <h3>Nội dung văn bản</h3>
                        <p>${doc.noidungchitiet || doc.noidung || 'Chưa có nội dung'}</p>
                    </div>
                    
                    ${filesHtml}
                </div>
            `;
            
            detailContainer.classList.add('active');
            document.getElementById('documentsContent').classList.remove('active');
            document.getElementById('dashboardContent').classList.remove('active');
            document.getElementById('membersContent').classList.remove('active');
        }

        // ===== MEMBER FUNCTIONS =====
        function loadSampleData() {
            members = getSampleMembers();
            documents = getSampleDocuments();
            filterMembersByBranch('all');
            filterDocumentsByType('dinhky');
            updateDashboardStats();
        }

        function filterMembersByBranch(branch) {
            let filtered = members;
            if (branch !== 'all') {
                filtered = members.filter(m => m.branch === branch);
            }
            renderMembersTable(filtered);
        }

        function renderMembersTable(data) {
            const tbody = document.getElementById('membersTableBody');
            if (!tbody) return;

            tbody.innerHTML = '';
            
            data.forEach((member, index) => {
                const row = document.createElement('tr');
                
                const dob = member.dob ? new Date(member.dob).toLocaleDateString('vi-VN') : '';
                const gender = member.gender || 'Nam';
                
                row.innerHTML = `
                    <td>${index + 1}</td>
                    <td class="member-photo-cell">
                        <div class="member-photo ${member.photo ? 'has-image' : ''}" onclick="viewPhoto(${member.id})">
                            ${member.photo ? 
                                `<img src="${member.photo}" alt="${member.name}">` : 
                                `<div class="photo-placeholder"><i class="fas fa-user"></i></div>`
                            }
                        </div>
                    </td>
                    <td>
                        <div class="member-name">${member.name || ''}</div>
                        <div class="member-info">${gender} - ${dob}</div>
                    </td>
                    <td class="position-cell">
                        ${member.chinhquyen ? `<span class="position-badge badge-chinhquyen">${member.chinhquyen}</span>` : '-'}
                    </td>
                    <td class="position-cell">
                        ${member.dang ? `<span class="position-badge badge-dang">${member.dang}</span>` : '-'}
                    </td>
                    <td class="position-cell">
                        ${member.congdoan ? `<span class="position-badge badge-congdoan">${member.congdoan}</span>` : '-'}
                    </td>
                    <td class="position-cell">
                        ${member.doan ? `<span class="position-badge badge-doan">${member.doan}</span>` : '-'}
                    </td>
                    <td>${member.branch || ''}</td>
                    <td class="action-cell">
                        <button class="action-btn-sm view" onclick="viewMember(${member.id})" title="Xem chi tiết"><i class="fas fa-eye"></i></button>
                        <button class="action-btn-sm edit" onclick="editMember(${member.id})" title="Chỉnh sửa"><i class="fas fa-edit"></i></button>
                        <button class="action-btn-sm delete" onclick="deleteMember(${member.id})" title="Xóa"><i class="fas fa-trash"></i></button>
                    </td>
                `;
                
                tbody.appendChild(row);
            });
            
            document.getElementById('tableInfo').innerHTML = `Hiển thị 1-${data.length} của ${members.length} đảng viên`;
        }

        function filterDocumentsByType(type) {
            const filtered = documents.filter(doc => doc.loai === type);
            renderDocumentsTable(filtered);
        }

        function filterDocumentsByStatus(status) {
            const filtered = documents.filter(doc => doc.trangthai === status);
            renderDocumentsTable(filtered);
        }

        function renderDocumentsTable(data) {
            const tbody = document.getElementById('documentsTableBody');
            if (!tbody) return;

            tbody.innerHTML = '';
            
            data.forEach((doc, index) => {
                const row = document.createElement('tr');
                row.setAttribute('onclick', `showDocumentDetail(${doc.id})`);
                
                const ngay = doc.ngaybanhanh ? new Date(doc.ngaybanhanh).toLocaleDateString('vi-VN') : 'Chưa có';
                
                const loaiClasses = {
                    'dinhky': 'badge-dinhky',
                    'chuyende': 'badge-chuyende',
                    'quytrinh': 'badge-quytrinh',
                    'luutru': 'badge-luutru'
                };
                
                const loaiText = {
                    'dinhky': 'Định kỳ',
                    'chuyende': 'Chuyên đề',
                    'quytrinh': 'Quy trình',
                    'luutru': 'Lưu trữ'
                };
                
                const trangthaiText = {
                    'banhanh': 'Đã ban hành',
                    'chopheduyet': 'Chờ duyệt',
                    'dangxuly': 'Đang xử lý',
                    'luutru': 'Lưu trữ'
                };
                
                const filesHtml = doc.files && doc.files.length > 0 
                    ? `<span class="file-attachment"><i class="fas fa-paperclip"></i> ${doc.files.length}</span>`
                    : '<span class="file-attachment" style="opacity: 0.5;"><i class="fas fa-paperclip"></i> 0</span>';
                
                row.innerHTML = `
                    <td><strong>${doc.sohieu || ''}</strong></td>
                    <td>
                        <div class="document-title">${doc.tieude || ''}</div>
                        <div class="document-meta">${doc.noidung ? doc.noidung.substring(0, 40) + '...' : ''}</div>
                    </td>
                    <td><span class="badge ${loaiClasses[doc.loai]}">${loaiText[doc.loai] || ''}</span></td>
                    <td>${ngay}</td>
                    <td>${doc.nguoiky || 'Chưa có'}</td>
                    <td>${filesHtml}</td>
                    <td>${trangthaiText[doc.trangthai] || ''}</td>
                    <td class="action-cell" onclick="event.stopPropagation()">
                        <button class="action-btn-sm view" onclick="showDocumentDetail(${doc.id})" title="Xem chi tiết"><i class="fas fa-eye"></i></button>
                        <button class="action-btn-sm edit" onclick="editDocument(${doc.id})" title="Chỉnh sửa"><i class="fas fa-edit"></i></button>
                        <button class="action-btn-sm delete" onclick="deleteDocument(${doc.id})" title="Xóa"><i class="fas fa-trash"></i></button>
                    </td>
                `;
                
                tbody.appendChild(row);
            });
            
            document.getElementById('documentTableInfo').innerHTML = `Hiển thị 1-${data.length} của ${data.length} văn bản`;
        }

        // ===== MODAL FUNCTIONS =====
        function openAddMemberModal() {
            currentMemberId = null;
            document.getElementById('modalTitle').innerHTML = '<i class="fas fa-user-plus"></i> THÊM ĐẢNG VIÊN MỚI';
            resetMemberForm();
            removePhoto();
            document.getElementById('memberModal').classList.add('active');
        }

        function openAddDocumentModal() {
            currentDocumentId = null;
            document.getElementById('documentModalTitle').innerHTML = '<i class="fas fa-file-alt"></i> ĐĂNG VĂN BẢN MỚI';
            resetDocumentForm();
            currentFiles = [];
            updateFileList();
            document.getElementById('documentModal').classList.add('active');
        }

        function editMember(id) {
            const member = members.find(m => m.id === id);
            if (!member) return;
            
            currentMemberId = id;
            document.getElementById('modalTitle').innerHTML = '<i class="fas fa-edit"></i> CHỈNH SỬA ĐẢNG VIÊN';
            
            document.getElementById('memberName').value = member.name || '';
            document.getElementById('memberDob').value = member.dob || '';
            document.getElementById('memberChinhquyen').value = member.chinhquyen || '';
            document.getElementById('memberDang').value = member.dang || '';
            document.getElementById('memberCongdoan').value = member.congdoan || '';
            document.getElementById('memberDoan').value = member.doan || '';
            document.getElementById('memberBranch').value = member.branch || 'Văn phòng Trung tâm';
            document.getElementById('memberPartyDate').value = member.partyDate || '';
            
            removePhoto();
            if (member.photo) {
                currentPhotoData = member.photo;
                const preview = document.getElementById('photoPreview');
                const img = document.getElementById('photoImage');
                img.src = member.photo;
                preview.classList.add('has-image');
                document.getElementById('photoInfo').innerHTML = '<i class="fas fa-check-circle" style="color: #28a745;"></i> Đã có ảnh';
            }
            
            document.getElementById('memberModal').classList.add('active');
        }

        function editDocument(id) {
            const doc = documents.find(d => d.id === id);
            if (!doc) return;
            
            currentDocumentId = id;
            document.getElementById('documentModalTitle').innerHTML = '<i class="fas fa-edit"></i> CHỈNH SỬA VĂN BẢN';
            
            document.getElementById('docSoHieu').value = doc.sohieu || '';
            document.getElementById('docLoai').value = doc.loai || 'dinhky';
            document.getElementById('docTieuDe').value = doc.tieude || '';
            document.getElementById('docNgayBanHanh').value = doc.ngaybanhanh || new Date().toISOString().split('T')[0];
            document.getElementById('docNguoiKy').value = doc.nguoiky || '';
            document.getElementById('docNoiDung').value = doc.noidung || '';
            document.getElementById('docNoiDungChiTiet').value = doc.noidungchitiet || '';
            document.getElementById('docTrangThai').value = doc.trangthai || 'banhanh';
            
            currentFiles = doc.files ? [...doc.files] : [];
            updateFileList();
            
            document.getElementById('documentModal').classList.add('active');
        }

        function viewMember(id) {
            const member = members.find(m => m.id === id);
            if (member) {
                const info = `THÔNG TIN ĐẢNG VIÊN\n\n` +
                    `Họ tên: ${member.name}\n` +
                    `Ngày sinh: ${member.dob ? new Date(member.dob).toLocaleDateString('vi-VN') : ''}\n` +
                    `Chính quyền: ${member.chinhquyen || 'Không'}\n` +
                    `Đảng: ${member.dang || 'Không'}\n` +
                    `Công đoàn: ${member.congdoan || 'Không'}\n` +
                    `Đoàn TN: ${member.doan || 'Không'}\n` +
                    `Chi bộ: ${member.branch}\n` +
                    `Ngày vào Đảng: ${member.partyDate ? new Date(member.partyDate).toLocaleDateString('vi-VN') : ''}`;
                alert(info);
            }
        }

        function deleteMember(id) {
            if (confirm('Bạn có chắc chắn muốn xóa đảng viên này?')) {
                members = members.filter(m => m.id !== id);
                filterMembersByBranch(currentBranch);
                updateDashboardStats();
                alert('Đã xóa đảng viên thành công');
            }
        }

        function deleteDocument(id) {
            if (confirm('Bạn có chắc chắn muốn xóa văn bản này?')) {
                documents = documents.filter(d => d.id !== id);
                filterDocumentsByType(currentDocType);
                updateDashboardStats();
                alert('Đã xóa văn bản thành công');
            }
        }

        function viewPhoto(id) {
            const member = members.find(m => m.id === id);
            if (member && member.photo) {
                window.open(member.photo, '_blank');
            } else {
                alert('Đảng viên chưa có ảnh');
            }
        }

        function saveMember() {
            const name = document.getElementById('memberName').value.trim();
            if (!name) {
                alert('Vui lòng nhập họ tên');
                return;
            }
            
            const memberData = {
                id: currentMemberId || Date.now(),
                name: name,
                dob: document.getElementById('memberDob').value,
                chinhquyen: document.getElementById('memberChinhquyen').value,
                dang: document.getElementById('memberDang').value,
                congdoan: document.getElementById('memberCongdoan').value,
                doan: document.getElementById('memberDoan').value,
                branch: document.getElementById('memberBranch').value,
                partyDate: document.getElementById('memberPartyDate').value,
                gender: 'Nam',
                photo: currentPhotoData || null
            };
            
            if (currentMemberId) {
                const index = members.findIndex(m => m.id === currentMemberId);
                if (index !== -1) {
                    members[index] = { ...members[index], ...memberData };
                }
                alert('Đã cập nhật thông tin đảng viên thành công');
            } else {
                members.push(memberData);
                alert('Đã thêm đảng viên mới thành công');
            }
            
            filterMembersByBranch(currentBranch);
            updateDashboardStats();
            closeMemberModal();
        }

        function saveDocument() {
            const sohieu = document.getElementById('docSoHieu').value.trim();
            const tieude = document.getElementById('docTieuDe').value.trim();
            
            if (!sohieu) {
                alert('Vui lòng nhập số hiệu văn bản');
                return;
            }
            
            if (!tieude) {
                alert('Vui lòng nhập tiêu đề văn bản');
                return;
            }
            
            const docData = {
                id: currentDocumentId || Date.now(),
                sohieu: sohieu,
                loai: document.getElementById('docLoai').value,
                tieude: tieude,
                ngaybanhanh: document.getElementById('docNgayBanHanh').value,
                nguoiky: document.getElementById('docNguoiKy').value,
                noidung: document.getElementById('docNoiDung').value,
                noidungchitiet: document.getElementById('docNoiDungChiTiet').value,
                files: currentFiles,
                trangthai: document.getElementById('docTrangThai').value
            };
            
            if (currentDocumentId) {
                const index = documents.findIndex(d => d.id === currentDocumentId);
                if (index !== -1) {
                    documents[index] = { ...documents[index], ...docData };
                }
                alert('Đã cập nhật văn bản thành công');
            } else {
                documents.push(docData);
                alert('Đã thêm văn bản mới thành công');
            }
            
            filterDocumentsByType(currentDocType);
            updateDashboardStats();
            closeDocumentModal();
        }

        function closeMemberModal() {
            document.getElementById('memberModal').classList.remove('active');
        }

        function closeDocumentModal() {
            document.getElementById('documentModal').classList.remove('active');
        }

        // ===== FORM RESET =====
        function resetMemberForm() {
            document.getElementById('memberName').value = '';
            document.getElementById('memberDob').value = '';
            document.getElementById('memberChinhquyen').value = '';
            document.getElementById('memberDang').value = '';
            document.getElementById('memberCongdoan').value = '';
            document.getElementById('memberDoan').value = '';
            document.getElementById('memberBranch').value = 'Văn phòng Trung tâm';
            document.getElementById('memberPartyDate').value = '';
        }

        function resetDocumentForm() {
            document.getElementById('docSoHieu').value = '';
            document.getElementById('docLoai').value = 'dinhky';
            document.getElementById('docTieuDe').value = '';
            document.getElementById('docNgayBanHanh').value = new Date().toISOString().split('T')[0];
            document.getElementById('docNguoiKy').value = '';
            document.getElementById('docNoiDung').value = '';
            document.getElementById('docNoiDungChiTiet').value = '';
            document.getElementById('docTrangThai').value = 'banhanh';
        }

        // ===== PHOTO UPLOAD HANDLERS =====
        function handlePhotoUpload(e) {
            const file = e.target.files[0];
            if (!file) return;

            if (file.size > 2 * 1024 * 1024) {
                alert('File ảnh không được vượt quá 2MB');
                return;
            }

            if (!file.type.match('image.*')) {
                alert('Chỉ chấp nhận file ảnh (JPG, PNG)');
                return;
            }

            currentPhotoFile = file;

            const reader = new FileReader();
            reader.onload = function(event) {
                currentPhotoData = event.target.result;
                
                const preview = document.getElementById('photoPreview');
                const img = document.getElementById('photoImage');
                
                img.src = event.target.result;
                preview.classList.add('has-image');
                
                document.getElementById('photoInfo').innerHTML = '<i class="fas fa-check-circle" style="color: #28a745;"></i> Đã chọn ảnh';
            };
            reader.readAsDataURL(file);
        }

        function handleFileUpload(e) {
            const files = Array.from(e.target.files);
            
            files.forEach(file => {
                if (file.size > 20 * 1024 * 1024) {
                    alert(`File ${file.name} vượt quá 20MB`);
                    return;
                }
                
                const reader = new FileReader();
                reader.onload = function(event) {
                    currentFiles.push({
                        name: file.name,
                        size: file.size,
                        type: file.name.split('.').pop().toLowerCase(),
                        data: event.target.result
                    });
                    updateFileList();
                };
                reader.readAsDataURL(file);
            });
            
            e.target.value = '';
        }

        function removePhoto() {
            currentPhotoFile = null;
            currentPhotoData = null;
            document.getElementById('photoUpload').value = '';
            
            const preview = document.getElementById('photoPreview');
            preview.classList.remove('has-image');
            document.getElementById('photoImage').src = '#';
            
            document.getElementById('photoInfo').innerHTML = '<i class="fas fa-info-circle"></i> JPG, PNG (tối đa 2MB)';
        }

        function removeFile(index) {
            currentFiles.splice(index, 1);
            updateFileList();
        }

        function updateFileList() {
            const fileList = document.getElementById('fileList');
            if (!fileList) return;

            fileList.innerHTML = '';
            
            if (currentFiles.length === 0) {
                fileList.innerHTML = '<p style="color: var(--text-light); text-align: center;">Chưa có file đính kèm</p>';
                return;
            }
            
            currentFiles.forEach((file, index) => {
                const size = formatFileSize(file.size);
                const fileItem = document.createElement('div');
                fileItem.className = 'file-item';
                fileItem.innerHTML = `
                    <div class="file-item-info">
                        <i class="fas ${getFileIcon(file.type)}"></i>
                        <span class="file-item-name">${file.name}</span>
                        <span class="file-item-size">${size}</span>
                    </div>
                    <i class="fas fa-times file-item-remove" onclick="removeFile(${index})"></i>
                `;
                fileList.appendChild(fileItem);
            });
        }

        // ===== SEARCH HANDLERS =====
        function handleMemberSearch(e) {
            const searchText = e.target.value.toLowerCase().trim();
            
            if (searchText === '') {
                filterMembersByBranch(currentBranch);
                return;
            }
            
            const filtered = members.filter(member => 
                member.name.toLowerCase().includes(searchText) ||
                (member.chinhquyen && member.chinhquyen.toLowerCase().includes(searchText)) ||
                (member.dang && member.dang.toLowerCase().includes(searchText)) ||
                (member.branch && member.branch.toLowerCase().includes(searchText))
            );
            
            renderMembersTable(filtered);
        }

        function handleDocumentSearch(e) {
            const searchText = e.target.value.toLowerCase().trim();
            
            if (searchText === '') {
                filterDocumentsByType(currentDocType);
                return;
            }
            
            const filtered = documents.filter(doc => 
                doc.tieude.toLowerCase().includes(searchText) ||
                doc.sohieu.toLowerCase().includes(searchText) ||
                (doc.noidung && doc.noidung.toLowerCase().includes(searchText))
            );
            
            renderDocumentsTable(filtered);
        }

        function handleDocTypeFilter(e) {
            const value = e.target.value;
            if (value === 'all') {
                renderDocumentsTable(documents);
            } else {
                filterDocumentsByType(value);
            }
        }

        // ===== UTILITY FUNCTIONS =====
        function formatFileSize(bytes) {
            if (bytes === 0) return '0 Bytes';
            const k = 1024;
            const sizes = ['Bytes', 'KB', 'MB', 'GB'];
            const i = Math.floor(Math.log(bytes) / Math.log(k));
            return parseFloat((bytes / Math.pow(k, i)).toFixed(2)) + ' ' + sizes[i];
        }

        function getFileIcon(type) {
            const icons = {
                'pdf': 'fa-file-pdf',
                'doc': 'fa-file-word',
                'docx': 'fa-file-word',
                'xls': 'fa-file-excel',
                'xlsx': 'fa-file-excel',
                'jpg': 'fa-file-image',
                'jpeg': 'fa-file-image',
                'png': 'fa-file-image',
                'txt': 'fa-file-alt'
            };
            return icons[type] || 'fa-file';
        }

        function debounce(func, wait) {
            let timeout;
            return function executedFunction(...args) {
                const later = () => {
                    clearTimeout(timeout);
                    func(...args);
                };
                clearTimeout(timeout);
                timeout = setTimeout(later, wait);
            };
        }

        function updateDashboardStats() {
            const totalMembers = members.length;
            const totalDocs = documents.length;
            const dinhkyDocs = documents.filter(d => d.loai === 'dinhky').length;
            const pendingDocs = documents.filter(d => d.trangthai === 'chopheduyet').length;
            const chuyendeDocs = documents.filter(d => d.loai === 'chuyende').length;
            
            document.getElementById('totalDocuments') && (document.getElementById('totalDocuments').innerText = totalDocs);
            document.getElementById('dinhkyDocs') && (document.getElementById('dinhkyDocs').innerText = dinhkyDocs);
            document.getElementById('chuyendeDocs') && (document.getElementById('chuyendeDocs').innerText = chuyendeDocs);
            document.getElementById('pendingDocs') && (document.getElementById('pendingDocs').innerText = pendingDocs);
            document.getElementById('memberStats') && (document.getElementById('memberStats').innerHTML = `${totalMembers} đảng viên`);
            document.getElementById('moduleDocStats') && (document.getElementById('moduleDocStats').innerHTML = `${totalDocs} văn bản`);
            
            updateActivityList();
        }

        function updateActivityList() {
            const activityList = document.getElementById('dashboardActivityList');
            if (!activityList) return;

            activityList.innerHTML = '';
            
            const activities = [];
            
            members.slice(0, 2).forEach(m => {
                activities.push({
                    icon: 'fa-user-plus',
                    title: 'Thêm đảng viên mới',
                    desc: `Đồng chí ${m.name}`,
                    time: 'Vừa xong'
                });
            });
            
            documents.slice(0, 2).forEach(d => {
                const ngay = d.ngaybanhanh ? new Date(d.ngaybanhanh).toLocaleDateString('vi-VN') : '';
                activities.push({
                    icon: 'fa-file-alt',
                    title: d.tieude,
                    desc: `${d.sohieu} - ${ngay}`,
                    time: 'Gần đây'
                });
            });
            
            if (activities.length === 0) {
                activities.push({
                    icon: 'fa-info-circle',
                    title: 'Chào mừng bạn đến với hệ thống',
                    desc: 'Quản lý công tác Đảng phiên bản 2.0',
                    time: 'Bây giờ'
                });
            }
            
            activities.slice(0, 3).forEach(act => {
                const item = document.createElement('div');
                item.className = 'activity-item';
                item.innerHTML = `
                    <div class="activity-icon"><i class="fas ${act.icon}"></i></div>
                    <div class="activity-content">
                        <div class="activity-title">${act.title}</div>
                        <div class="activity-desc">${act.desc}</div>
                    </div>
                    <div class="activity-time">${act.time}</div>
                `;
                activityList.appendChild(item);
            });
        }

        // ===== SAMPLE DATA =====
        function getSampleMembers() {
            return [
                {
                    id: 1,
                    name: 'Vũ Nam Thắng',
                    gender: 'Nam',
                    dob: '1975-05-15',
                    chinhquyen: 'Giám đốc',
                    dang: 'Bí thư Đảng ủy',
                    congdoan: 'Ủy viên BCH',
                    doan: '',
                    branch: 'Văn phòng Trung tâm',
                    partyDate: '2000-05-15',
                    photo: null
                },
                {
                    id: 2,
                    name: 'Hồ Xuân Hoà',
                    gender: 'Nam',
                    dob: '1978-08-20',
                    chinhquyen: 'Phó Giám đốc',
                    dang: 'Phó Bí thư',
                    congdoan: 'Chủ tịch CĐ',
                    doan: '',
                    branch: 'Văn phòng Trung tâm',
                    partyDate: '2002-08-20',
                    photo: null
                },
                {
                    id: 3,
                    name: 'Trần Thị Lan',
                    gender: 'Nữ',
                    dob: '1985-03-10',
                    chinhquyen: 'Trưởng phòng',
                    dang: 'Đảng viên',
                    congdoan: 'Trưởng ban Nữ công',
                    doan: 'Bí thư Đoàn',
                    branch: 'Văn phòng Trung tâm',
                    partyDate: '2010-03-10',
                    photo: null
                },
                {
                    id: 4,
                    name: 'Lê Văn Cường',
                    gender: 'Nam',
                    dob: '1980-12-02',
                    chinhquyen: 'Đội trưởng',
                    dang: 'Bí thư Chi bộ',
                    congdoan: 'Tổ trưởng CĐ',
                    doan: '',
                    branch: 'Đội Bảo trì Sân đường',
                    partyDate: '2005-12-02',
                    photo: null
                }
            ];
        }

        function getSampleDocuments() {
            return [
                {
                    id: 1,
                    sohieu: '01/NQ-ĐU',
                    tieude: 'Nghị quyết về công tác xây dựng Đảng năm 2026',
                    loai: 'dinhky',
                    ngaybanhanh: '2026-01-15',
                    nguoiky: 'Vũ Nam Thắng',
                    noidung: 'Nghị quyết về công tác xây dựng Đảng năm 2026',
                    noidungchitiet: 'Nghị quyết này đề ra các mục tiêu, nhiệm vụ trọng tâm về công tác xây dựng Đảng trong năm 2026...',
                    files: [
                        { name: 'NQ-01-2026.pdf', size: 1240000, type: 'pdf' }
                    ],
                    trangthai: 'banhanh'
                },
                {
                    id: 2,
                    sohieu: '02/NQ-ĐU',
                    tieude: 'Nghị quyết về công tác cán bộ nhiệm kỳ 2025-2030',
                    loai: 'chuyende',
                    ngaybanhanh: '2026-02-20',
                    nguoiky: 'Hồ Xuân Hoà',
                    noidung: 'Nghị quyết về công tác cán bộ',
                    noidungchitiet: 'Nghị quyết này quy định về công tác quy hoạch, đào tạo, bổ nhiệm cán bộ...',
                    files: [
                        { name: 'NQ-02-2026.pdf', size: 890000, type: 'pdf' },
                        { name: 'PhuLuc.xlsx', size: 560000, type: 'xlsx' }
                    ],
                    trangthai: 'chopheduyet'
                },
                {
                    id: 3,
                    sohieu: '03/QT-ĐU',
                    tieude: 'Quy trình xử lý văn bản đến và đi',
                    loai: 'quytrinh',
                    ngaybanhanh: '2026-03-10',
                    nguoiky: 'Trần Thị Lan',
                    noidung: 'Quy trình xử lý văn bản',
                    noidungchitiet: 'Quy trình này hướng dẫn chi tiết các bước tiếp nhận, xử lý, ban hành văn bản...',
                    files: [
                        { name: 'QT-03-2026.pdf', size: 2100000, type: 'pdf' }
                    ],
                    trangthai: 'banhanh'
                }
            ];
        }

        // Export functions to global scope for onclick handlers
        window.showDocumentDetail = showDocumentDetail;
        window.viewMember = viewMember;
        window.editMember = editMember;
        window.deleteMember = deleteMember;
        window.viewPhoto = viewPhoto;
        window.editDocument = editDocument;
        window.deleteDocument = deleteDocument;
        window.downloadFile = (name) => alert('Đang tải file: ' + name);
        window.closeMemberModal = closeMemberModal;
        window.closeDocumentModal = closeDocumentModal;
        window.removePhoto = removePhoto;
        window.removeFile = removeFile;
    </script>
    <script>
    // ===== CẤU HÌNH =====
    const API_URL = ''; // Để trống nếu chưa có backend

    // ===== BIẾN TOÀN CỤC =====
    let currentMemberId = null;
    let currentDocumentId = null;
    let currentPhotoFile = null;
    let currentPhotoData = null;
    let currentFiles = [];
    let currentDocType = 'dinhky';
    let currentBranch = 'all';
    let members = [];
    let documents = [];

    // ===== KHỞI TẠO =====
    document.addEventListener('DOMContentLoaded', function() {
        console.log('Trang đã sẵn sàng');
        
        // Khởi tạo tất cả các event listeners
        initEventListeners();
        
        // Load logo từ localStorage
        loadSavedLogo();
        
        // Hiển thị dashboard mặc định
        showDashboard();
        
        // Load dữ liệu mẫu
        loadSampleData();
        
        // Đảm bảo menu active đúng
        setActiveMenu();
    });

    // ===== INIT EVENT LISTENERS =====
    function initEventListeners() {
        // Logo upload
        const logoUpload = document.getElementById('logoUpload');
        if (logoUpload) {
            // Xóa event cũ để tránh trùng lặp
            logoUpload.replaceWith(logoUpload.cloneNode(true));
            document.getElementById('logoUpload').addEventListener('click', handleLogoUpload);
        }

        // Menu toggle
        const documentsMenuToggle = document.getElementById('documentsMenuToggle');
        if (documentsMenuToggle) {
            documentsMenuToggle.addEventListener('click', function(e) {
                e.preventDefault();
                document.getElementById('documentsSubmenu').classList.toggle('show');
            });
        }

        const membersMenuToggle = document.getElementById('membersMenuToggle');
        if (membersMenuToggle) {
            membersMenuToggle.addEventListener('click', function(e) {
                e.preventDefault();
                document.getElementById('membersSubmenu').classList.toggle('show');
            });
        }

        // Main menu items
        const dashboardMenu = document.getElementById('dashboardMenu');
        if (dashboardMenu) {
            dashboardMenu.addEventListener('click', function(e) {
                e.preventDefault();
                showDashboard();
            });
        }

        // Documents submenu - QUAN TRỌNG: các mục con của văn bản
        document.querySelectorAll('#documentsSubmenu .submenu-item').forEach(item => {
            // Xóa event cũ
            const newItem = item.cloneNode(true);
            item.parentNode.replaceChild(newItem, item);
            
            newItem.addEventListener('click', function(e) {
                e.preventDefault();
                e.stopPropagation();
                const type = this.getAttribute('data-type');
                if (type) {
                    // Cập nhật active class
                    document.querySelectorAll('#documentsSubmenu .submenu-item').forEach(i => {
                        i.classList.remove('active');
                    });
                    this.classList.add('active');
                    
                    // Cập nhật current type
                    currentDocType = type;
                    
                    // Cập nhật tiêu đề
                    updateDocumentTitleByType(type);
                    
                    // Lọc và hiển thị văn bản
                    filterDocumentsByType(type);
                    
                    // Hiển thị trang documents
                    showDocuments();
                }
            });
        });

        // Members submenu - QUAN TRỌNG: các mục con của đảng viên
        document.querySelectorAll('#membersSubmenu .submenu-item').forEach(item => {
            // Xóa event cũ
            const newItem = item.cloneNode(true);
            item.parentNode.replaceChild(newItem, item);
            
            newItem.addEventListener('click', function(e) {
                e.preventDefault();
                e.stopPropagation();
                const branch = this.getAttribute('data-branch');
                if (branch) {
                    // Cập nhật active class
                    document.querySelectorAll('#membersSubmenu .submenu-item').forEach(i => {
                        i.classList.remove('active');
                    });
                    this.classList.add('active');
                    
                    // Cập nhật current branch
                    currentBranch = branch;
                    
                    // Cập nhật tiêu đề
                    updateMemberTitleByBranch(branch, this.textContent.trim());
                    
                    // Lọc và hiển thị đảng viên
                    filterMembersByBranch(branch);
                    
                    // Hiển thị trang members
                    showMembers();
                }
            });
        });

        // Other menu items
        const shMenu = document.getElementById('shMenu');
        if (shMenu) {
            shMenu.addEventListener('click', (e) => {
                e.preventDefault();
                alert('Chức năng Sinh hoạt Đảng đang phát triển');
            });
        }

        const ptMenu = document.getElementById('ptMenu');
        if (ptMenu) {
            ptMenu.addEventListener('click', (e) => {
                e.preventDefault();
                alert('Chức năng Công tác Phát triển Đảng đang phát triển');
            });
        }

        const bcMenu = document.getElementById('bcMenu');
        if (bcMenu) {
            bcMenu.addEventListener('click', (e) => {
                e.preventDefault();
                alert('Chức năng Báo cáo Thống kê đang phát triển');
            });
        }

        const htMenu = document.getElementById('htMenu');
        if (htMenu) {
            htMenu.addEventListener('click', (e) => {
                e.preventDefault();
                alert('Chức năng Hệ thống đang phát triển');
            });
        }

        // Quick access
        const addMemberBtn = document.getElementById('addMemberBtn');
        if (addMemberBtn) {
            addMemberBtn.addEventListener('click', (e) => {
                e.preventDefault();
                showMembers();
                openAddMemberModal();
            });
        }

        const addDocumentBtn = document.getElementById('addDocumentBtn');
        if (addDocumentBtn) {
            addDocumentBtn.addEventListener('click', (e) => {
                e.preventDefault();
                showDocuments();
                openAddDocumentModal();
            });
        }

        const pendingDocsBtn = document.getElementById('pendingDocsBtn');
        if (pendingDocsBtn) {
            pendingDocsBtn.addEventListener('click', (e) => {
                e.preventDefault();
                showDocuments();
                filterDocumentsByStatus('chopheduyet');
            });
        }

        const docNotifications = document.getElementById('docNotifications');
        if (docNotifications) {
            docNotifications.addEventListener('click', (e) => {
                e.preventDefault();
                alert('Có 2 văn bản mới cần xử lý');
            });
        }

        // Action buttons
        const createNewBtn = document.getElementById('createNewBtn');
        if (createNewBtn) {
            createNewBtn.addEventListener('click', () => {
                openAddDocumentModal();
            });
        }

        const exportReportBtn = document.getElementById('exportReportBtn');
        if (exportReportBtn) {
            exportReportBtn.addEventListener('click', () => {
                alert('Chức năng Xuất báo cáo đang phát triển');
            });
        }

        const addNewMemberBtn = document.getElementById('addNewMemberBtn');
        if (addNewMemberBtn) {
            addNewMemberBtn.addEventListener('click', () => {
                openAddMemberModal();
            });
        }

        const addNewDocumentBtn = document.getElementById('addNewDocumentBtn');
        if (addNewDocumentBtn) {
            addNewDocumentBtn.addEventListener('click', () => {
                openAddDocumentModal();
            });
        }

        const exportMembersBtn = document.getElementById('exportMembersBtn');
        if (exportMembersBtn) {
            exportMembersBtn.addEventListener('click', () => {
                alert('Chức năng Xuất danh sách đảng viên đang phát triển');
            });
        }

        const exportDocsBtn = document.getElementById('exportDocsBtn');
        if (exportDocsBtn) {
            exportDocsBtn.addEventListener('click', () => {
                alert('Chức năng Xuất danh sách văn bản đang phát triển');
            });
        }

        // Module cards
        const goToDocuments = document.getElementById('goToDocuments');
        if (goToDocuments) {
            goToDocuments.addEventListener('click', () => {
                showDocuments();
            });
        }

        const goToMembers = document.getElementById('goToMembers');
        if (goToMembers) {
            goToMembers.addEventListener('click', () => {
                showMembers();
            });
        }

        const goToSh = document.getElementById('goToSh');
        if (goToSh) {
            goToSh.addEventListener('click', () => {
                alert('Chức năng Sinh hoạt Đảng đang phát triển');
            });
        }

        // Logout
        const logoutBtn = document.getElementById('logoutBtn');
        if (logoutBtn) {
            logoutBtn.addEventListener('click', () => {
                if (confirm('Bạn có chắc chắn muốn đăng xuất?')) {
                    alert('Đã đăng xuất');
                }
            });
        }

        // Footer links
        const helpLink = document.getElementById('helpLink');
        if (helpLink) {
            helpLink.addEventListener('click', (e) => {
                e.preventDefault();
                alert('Chức năng Trợ giúp đang phát triển');
            });
        }

        const guideLink = document.getElementById('guideLink');
        if (guideLink) {
            guideLink.addEventListener('click', (e) => {
                e.preventDefault();
                alert('Chức năng Hướng dẫn sử dụng đang phát triển');
            });
        }

        const contactLink = document.getElementById('contactLink');
        if (contactLink) {
            contactLink.addEventListener('click', (e) => {
                e.preventDefault();
                alert('Chức năng Liên hệ đang phát triển');
            });
        }

        const policyLink = document.getElementById('policyLink');
        if (policyLink) {
            policyLink.addEventListener('click', (e) => {
                e.preventDefault();
                alert('Chức năng Chính sách bảo mật đang phát triển');
            });
        }

        // File upload
        const photoUpload = document.getElementById('photoUpload');
        if (photoUpload) {
            photoUpload.addEventListener('change', handlePhotoUpload);
        }

        const fileUpload = document.getElementById('fileUpload');
        if (fileUpload) {
            fileUpload.addEventListener('change', handleFileUpload);
        }

        // Search
        const searchMember = document.getElementById('searchMember');
        if (searchMember) {
            searchMember.addEventListener('keyup', debounce(handleMemberSearch, 500));
        }

        const searchDocument = document.getElementById('searchDocument');
        if (searchDocument) {
            searchDocument.addEventListener('keyup', debounce(handleDocumentSearch, 500));
        }

        // Filter
        const docTypeFilter = document.getElementById('docTypeFilter');
        if (docTypeFilter) {
            docTypeFilter.addEventListener('change', handleDocTypeFilter);
        }

        // Close modal when clicking outside
        window.addEventListener('click', (e) => {
            const memberModal = document.getElementById('memberModal');
            const docModal = document.getElementById('documentModal');
            if (e.target === memberModal) closeMemberModal();
            if (e.target === docModal) closeDocumentModal();
        });
    }

    // ===== LOGO UPLOAD - LƯU VÀO LOCALSTORAGE =====
    function handleLogoUpload() {
        const fileInput = document.createElement('input');
        fileInput.type = 'file';
        fileInput.accept = 'image/*';
        
        fileInput.addEventListener('change', function(e) {
            const file = e.target.files[0];
            if (file) {
                if (file.size > 2 * 1024 * 1024) {
                    alert('Logo không được vượt quá 2MB');
                    return;
                }

                const reader = new FileReader();
                reader.onload = function(event) {
                    const imageData = event.target.result;
                    
                    try {
                        localStorage.setItem('partyLogo', imageData);
                        applyLogo(imageData);
                        alert('Đã lưu logo thành công!');
                    } catch (e) {
                        alert('Không thể lưu logo. Có thể file quá lớn.');
                    }
                };
                reader.readAsDataURL(file);
            }
        });
        
        fileInput.click();
    }

    function loadSavedLogo() {
        const savedLogo = localStorage.getItem('partyLogo');
        if (savedLogo) {
            applyLogo(savedLogo);
        }
    }

    function applyLogo(imageData) {
        const flagContainer = document.getElementById('logoUpload');
        if (!flagContainer) return;
        
        // Kiểm tra xem đã có ảnh chưa
        const existingImg = flagContainer.querySelector('img');
        
        if (existingImg) {
            existingImg.src = imageData;
        } else {
            // Xóa flag cũ
            flagContainer.innerHTML = '';
            
            // Tạo ảnh mới
            const logoImg = document.createElement('img');
            logoImg.src = imageData;
            logoImg.style.width = '100%';
            logoImg.style.height = '100%';
            logoImg.style.objectFit = 'contain';
            
            flagContainer.appendChild(logoImg);
            flagContainer.classList.add('has-logo');
            
            // Thêm overlay
            const overlay = document.createElement('div');
            overlay.className = 'logo-overlay';
            overlay.innerHTML = '<i class="fas fa-upload"></i> Thay đổi logo';
            flagContainer.appendChild(overlay);
        }
    }

    // ===== MENU FUNCTIONS =====
    function updateDocumentTitleByType(type) {
        const titles = {
            'dinhky': { title: 'NGHỊ QUYẾT ĐỊNH KỲ', subtitle: 'Các nghị quyết định kỳ của Đảng ủy' },
            'chuyende': { title: 'NGHỊ QUYẾT CHUYÊN ĐỀ', subtitle: 'Các nghị quyết chuyên đề' },
            'quytrinh': { title: 'QUY TRÌNH XỬ LÝ', subtitle: 'Các quy trình, hướng dẫn nghiệp vụ' },
            'luutru': { title: 'KHO LƯU TRỮ', subtitle: 'Các văn bản đã lưu trữ' }
        };

        const pageTitle = document.getElementById('documentsPageTitle');
        const pageSubtitle = document.getElementById('documentsPageSubtitle');
        const tableTitle = document.getElementById('documentTableTitle');
        
        if (pageTitle) pageTitle.innerText = 'QUẢN LÝ VĂN BẢN, NGHỊ QUYẾT';
        if (pageSubtitle) pageSubtitle.innerText = titles[type]?.subtitle || '';
        if (tableTitle) tableTitle.innerText = 'DANH SÁCH ' + (titles[type]?.title || '');
    }

    function updateMemberTitleByBranch(branch, branchName) {
        const pageTitle = document.getElementById('membersPageTitle');
        const pageSubtitle = document.getElementById('membersPageSubtitle');
        const tableTitle = document.getElementById('tableTitle');
        
        if (pageTitle) pageTitle.innerText = 'DANH SÁCH ĐẢNG VIÊN';
        if (pageSubtitle) pageSubtitle.innerText = branch === 'all' ? 'Tất cả các chi bộ' : branchName;
        if (tableTitle) tableTitle.innerText = 'DANH SÁCH ĐẢNG VIÊN' + (branch !== 'all' ? ' - ' + branchName.toUpperCase() : '');
    }

    function setActiveMenu() {
        // Xác định trang hiện tại và set active menu
        if (document.getElementById('dashboardContent').classList.contains('active')) {
            document.querySelectorAll('.menu-item').forEach(item => item.classList.remove('active'));
            document.getElementById('dashboardMenu')?.classList.add('active');
        } else if (document.getElementById('membersContent').classList.contains('active')) {
            document.querySelectorAll('.menu-item').forEach(item => item.classList.remove('active'));
            document.getElementById('membersMenuToggle')?.classList.add('active');
        } else if (document.getElementById('documentsContent').classList.contains('active')) {
            document.querySelectorAll('.menu-item').forEach(item => item.classList.remove('active'));
            document.getElementById('documentsMenuToggle')?.classList.add('active');
        }
    }

    // ===== PAGE NAVIGATION =====
    function showDashboard() {
        document.getElementById('dashboardContent').classList.add('active');
        document.getElementById('membersContent').classList.remove('active');
        document.getElementById('documentsContent').classList.remove('active');
        document.getElementById('documentDetailContent').classList.remove('active');

        document.querySelectorAll('.menu-item').forEach(item => item.classList.remove('active'));
        document.getElementById('dashboardMenu').classList.add('active');
    }

    function showMembers() {
        document.getElementById('membersContent').classList.add('active');
        document.getElementById('dashboardContent').classList.remove('active');
        document.getElementById('documentsContent').classList.remove('active');
        document.getElementById('documentDetailContent').classList.remove('active');

        document.querySelectorAll('.menu-item').forEach(item => item.classList.remove('active'));
        document.getElementById('membersMenuToggle').classList.add('active');
    }

    function showDocuments() {
        document.getElementById('documentsContent').classList.add('active');
        document.getElementById('dashboardContent').classList.remove('active');
        document.getElementById('membersContent').classList.remove('active');
        document.getElementById('documentDetailContent').classList.remove('active');

        document.querySelectorAll('.menu-item').forEach(item => item.classList.remove('active'));
        document.getElementById('documentsMenuToggle').classList.add('active');
    }

    function showDocumentDetail(id) {
        const doc = documents.find(d => d.id === id);
        if (!doc) return;

        const detailContainer = document.getElementById('documentDetailContent');
        
        const ngay = doc.ngaybanhanh ? new Date(doc.ngaybanhanh).toLocaleDateString('vi-VN') : 'Chưa có';
        
        const loaiText = {
            'dinhky': 'Nghị quyết định kỳ',
            'chuyende': 'Nghị quyết chuyên đề',
            'quytrinh': 'Quy trình xử lý',
            'luutru': 'Kho lưu trữ'
        };
        
        const loaiClass = {
            'dinhky': 'badge-dinhky',
            'chuyende': 'badge-chuyende',
            'quytrinh': 'badge-quytrinh',
            'luutru': 'badge-luutru'
        };
        
        const trangthaiText = {
            'banhanh': 'Đã ban hành',
            'chopheduyet': 'Chờ phê duyệt',
            'dangxuly': 'Đang xử lý',
            'luutru': 'Lưu trữ'
        };
        
        let filesHtml = '';
        if (doc.files && doc.files.length > 0) {
            filesHtml = '<div class="attachment-list"><h4><i class="fas fa-paperclip"></i> File đính kèm</h4>';
            doc.files.forEach(file => {
                const size = formatFileSize(file.size);
                filesHtml += `
                    <div class="attachment-item">
                        <div class="attachment-info">
                            <i class="fas ${getFileIcon(file.type)}"></i>
                            <div>
                                <span class="attachment-name">${file.name}</span>
                                <span class="attachment-size">${size}</span>
                            </div>
                        </div>
                        <button class="attachment-download" onclick="downloadFile('${file.name}')">
                            <i class="fas fa-download"></i> Tải về
                        </button>
                    </div>
                `;
            });
            filesHtml += '</div>';
        }
        
        detailContainer.innerHTML = `
            <div class="dashboard-header">
                <div class="title-section">
                    <h2>CHI TIẾT VĂN BẢN</h2>
                    <p>${doc.tieude}</p>
                </div>
                <div class="action-buttons">
                    <button class="action-btn secondary" onclick="showDocuments()">
                        <i class="fas fa-arrow-left"></i> Quay lại
                    </button>
                    <button class="action-btn primary" onclick="editDocument(${doc.id})">
                        <i class="fas fa-edit"></i> Chỉnh sửa
                    </button>
                </div>
            </div>
            
            <div class="document-detail">
                <div class="document-header">
                    <h2>${doc.tieude}</h2>
                    <span class="badge ${loaiClass[doc.loai]}" style="padding: 6px 12px;">${loaiText[doc.loai]}</span>
                </div>
                
                <div class="document-meta-info">
                    <div class="meta-item">
                        <span class="meta-label">Số hiệu</span>
                        <span class="meta-value">${doc.sohieu}</span>
                    </div>
                    <div class="meta-item">
                        <span class="meta-label">Ngày ban hành</span>
                        <span class="meta-value">${ngay}</span>
                    </div>
                    <div class="meta-item">
                        <span class="meta-label">Người ký</span>
                        <span class="meta-value">${doc.nguoiky || 'Chưa có'}</span>
                    </div>
                    <div class="meta-item">
                        <span class="meta-label">Trạng thái</span>
                        <span class="meta-value">${trangthaiText[doc.trangthai] || ''}</span>
                    </div>
                </div>
                
                <div class="document-content">
                    <h3>Nội dung văn bản</h3>
                    <p>${doc.noidungchitiet || doc.noidung || 'Chưa có nội dung'}</p>
                </div>
                
                ${filesHtml}
            </div>
        `;
        
        detailContainer.classList.add('active');
        document.getElementById('documentsContent').classList.remove('active');
        document.getElementById('dashboardContent').classList.remove('active');
        document.getElementById('membersContent').classList.remove('active');
    }

    // ===== MEMBER FUNCTIONS =====
    function loadSampleData() {
        members = getSampleMembers();
        documents = getSampleDocuments();
        filterMembersByBranch('all');
        filterDocumentsByType('dinhky');
        updateDashboardStats();
    }

    function filterMembersByBranch(branch) {
        let filtered = members;
        if (branch !== 'all') {
            filtered = members.filter(m => m.branch === branch);
        }
        renderMembersTable(filtered);
    }

    function renderMembersTable(data) {
        const tbody = document.getElementById('membersTableBody');
        if (!tbody) return;

        tbody.innerHTML = '';
        
        data.forEach((member, index) => {
            const row = document.createElement('tr');
            
            const dob = member.dob ? new Date(member.dob).toLocaleDateString('vi-VN') : '';
            const gender = member.gender || 'Nam';
            
            row.innerHTML = `
                <td>${index + 1}</td>
                <td class="member-photo-cell">
                    <div class="member-photo ${member.photo ? 'has-image' : ''}" onclick="viewPhoto(${member.id})">
                        ${member.photo ? 
                            `<img src="${member.photo}" alt="${member.name}">` : 
                            `<div class="photo-placeholder"><i class="fas fa-user"></i></div>`
                        }
                    </div>
                </td>
                <td>
                    <div class="member-name">${member.name || ''}</div>
                    <div class="member-info">${gender} - ${dob}</div>
                </td>
                <td class="position-cell">
                    ${member.chinhquyen ? `<span class="position-badge badge-chinhquyen">${member.chinhquyen}</span>` : '-'}
                </td>
                <td class="position-cell">
                    ${member.dang ? `<span class="position-badge badge-dang">${member.dang}</span>` : '-'}
                </td>
                <td class="position-cell">
                    ${member.congdoan ? `<span class="position-badge badge-congdoan">${member.congdoan}</span>` : '-'}
                </td>
                <td class="position-cell">
                    ${member.doan ? `<span class="position-badge badge-doan">${member.doan}</span>` : '-'}
                </td>
                <td>${member.branch || ''}</td>
                <td class="action-cell">
                    <button class="action-btn-sm view" onclick="viewMember(${member.id})" title="Xem chi tiết"><i class="fas fa-eye"></i></button>
                    <button class="action-btn-sm edit" onclick="editMember(${member.id})" title="Chỉnh sửa"><i class="fas fa-edit"></i></button>
                    <button class="action-btn-sm delete" onclick="deleteMember(${member.id})" title="Xóa"><i class="fas fa-trash"></i></button>
                </td>
            `;
            
            tbody.appendChild(row);
        });
        
        const tableInfo = document.getElementById('tableInfo');
        if (tableInfo) {
            tableInfo.innerHTML = `Hiển thị 1-${data.length} của ${members.length} đảng viên`;
        }
    }

    function filterDocumentsByType(type) {
        const filtered = documents.filter(doc => doc.loai === type);
        renderDocumentsTable(filtered);
    }

    function filterDocumentsByStatus(status) {
        const filtered = documents.filter(doc => doc.trangthai === status);
        renderDocumentsTable(filtered);
    }

    function renderDocumentsTable(data) {
        const tbody = document.getElementById('documentsTableBody');
        if (!tbody) return;

        tbody.innerHTML = '';
        
        data.forEach((doc, index) => {
            const row = document.createElement('tr');
            row.setAttribute('onclick', `showDocumentDetail(${doc.id})`);
            
            const ngay = doc.ngaybanhanh ? new Date(doc.ngaybanhanh).toLocaleDateString('vi-VN') : 'Chưa có';
            
            const loaiClasses = {
                'dinhky': 'badge-dinhky',
                'chuyende': 'badge-chuyende',
                'quytrinh': 'badge-quytrinh',
                'luutru': 'badge-luutru'
            };
            
            const loaiText = {
                'dinhky': 'Định kỳ',
                'chuyende': 'Chuyên đề',
                'quytrinh': 'Quy trình',
                'luutru': 'Lưu trữ'
            };
            
            const trangthaiText = {
                'banhanh': 'Đã ban hành',
                'chopheduyet': 'Chờ duyệt',
                'dangxuly': 'Đang xử lý',
                'luutru': 'Lưu trữ'
            };
            
            const filesHtml = doc.files && doc.files.length > 0 
                ? `<span class="file-attachment"><i class="fas fa-paperclip"></i> ${doc.files.length}</span>`
                : '<span class="file-attachment" style="opacity: 0.5;"><i class="fas fa-paperclip"></i> 0</span>';
            
            row.innerHTML = `
                <td><strong>${doc.sohieu || ''}</strong></td>
                <td>
                    <div class="document-title">${doc.tieude || ''}</div>
                    <div class="document-meta">${doc.noidung ? doc.noidung.substring(0, 40) + '...' : ''}</div>
                </td>
                <td><span class="badge ${loaiClasses[doc.loai]}">${loaiText[doc.loai] || ''}</span></td>
                <td>${ngay}</td>
                <td>${doc.nguoiky || 'Chưa có'}</td>
                <td>${filesHtml}</td>
                <td>${trangthaiText[doc.trangthai] || ''}</td>
                <td class="action-cell" onclick="event.stopPropagation()">
                    <button class="action-btn-sm view" onclick="showDocumentDetail(${doc.id})" title="Xem chi tiết"><i class="fas fa-eye"></i></button>
                    <button class="action-btn-sm edit" onclick="editDocument(${doc.id})" title="Chỉnh sửa"><i class="fas fa-edit"></i></button>
                    <button class="action-btn-sm delete" onclick="deleteDocument(${doc.id})" title="Xóa"><i class="fas fa-trash"></i></button>
                </td>
            `;
            
            tbody.appendChild(row);
        });
        
        const documentTableInfo = document.getElementById('documentTableInfo');
        if (documentTableInfo) {
            documentTableInfo.innerHTML = `Hiển thị 1-${data.length} của ${data.length} văn bản`;
        }
    }

    // ===== MODAL FUNCTIONS =====
    function openAddMemberModal() {
        currentMemberId = null;
        const modalTitle = document.getElementById('modalTitle');
        if (modalTitle) {
            modalTitle.innerHTML = '<i class="fas fa-user-plus"></i> THÊM ĐẢNG VIÊN MỚI';
        }
        resetMemberForm();
        removePhoto();
        document.getElementById('memberModal').classList.add('active');
    }

    function openAddDocumentModal() {
        currentDocumentId = null;
        const modalTitle = document.getElementById('documentModalTitle');
        if (modalTitle) {
            modalTitle.innerHTML = '<i class="fas fa-file-alt"></i> ĐĂNG VĂN BẢN MỚI';
        }
        resetDocumentForm();
        currentFiles = [];
        updateFileList();
        document.getElementById('documentModal').classList.add('active');
    }

    function editMember(id) {
        const member = members.find(m => m.id === id);
        if (!member) return;
        
        currentMemberId = id;
        const modalTitle = document.getElementById('modalTitle');
        if (modalTitle) {
            modalTitle.innerHTML = '<i class="fas fa-edit"></i> CHỈNH SỬA ĐẢNG VIÊN';
        }
        
        document.getElementById('memberName').value = member.name || '';
        document.getElementById('memberDob').value = member.dob || '';
        document.getElementById('memberChinhquyen').value = member.chinhquyen || '';
        document.getElementById('memberDang').value = member.dang || '';
        document.getElementById('memberCongdoan').value = member.congdoan || '';
        document.getElementById('memberDoan').value = member.doan || '';
        document.getElementById('memberBranch').value = member.branch || 'Văn phòng Trung tâm';
        document.getElementById('memberPartyDate').value = member.partyDate || '';
        
        removePhoto();
        if (member.photo) {
            currentPhotoData = member.photo;
            const preview = document.getElementById('photoPreview');
            const img = document.getElementById('photoImage');
            img.src = member.photo;
            preview.classList.add('has-image');
            const photoInfo = document.getElementById('photoInfo');
            if (photoInfo) {
                photoInfo.innerHTML = '<i class="fas fa-check-circle" style="color: #28a745;"></i> Đã có ảnh';
            }
        }
        
        document.getElementById('memberModal').classList.add('active');
    }

    function editDocument(id) {
        const doc = documents.find(d => d.id === id);
        if (!doc) return;
        
        currentDocumentId = id;
        const modalTitle = document.getElementById('documentModalTitle');
        if (modalTitle) {
            modalTitle.innerHTML = '<i class="fas fa-edit"></i> CHỈNH SỬA VĂN BẢN';
        }
        
        document.getElementById('docSoHieu').value = doc.sohieu || '';
        document.getElementById('docLoai').value = doc.loai || 'dinhky';
        document.getElementById('docTieuDe').value = doc.tieude || '';
        document.getElementById('docNgayBanHanh').value = doc.ngaybanhanh || new Date().toISOString().split('T')[0];
        document.getElementById('docNguoiKy').value = doc.nguoiky || '';
        document.getElementById('docNoiDung').value = doc.noidung || '';
        document.getElementById('docNoiDungChiTiet').value = doc.noidungchitiet || '';
        document.getElementById('docTrangThai').value = doc.trangthai || 'banhanh';
        
        currentFiles = doc.files ? [...doc.files] : [];
        updateFileList();
        
        document.getElementById('documentModal').classList.add('active');
    }

    function viewMember(id) {
        const member = members.find(m => m.id === id);
        if (member) {
            const info = `THÔNG TIN ĐẢNG VIÊN\n\n` +
                `Họ tên: ${member.name}\n` +
                `Ngày sinh: ${member.dob ? new Date(member.dob).toLocaleDateString('vi-VN') : ''}\n` +
                `Chính quyền: ${member.chinhquyen || 'Không'}\n` +
                `Đảng: ${member.dang || 'Không'}\n` +
                `Công đoàn: ${member.congdoan || 'Không'}\n` +
                `Đoàn TN: ${member.doan || 'Không'}\n` +
                `Chi bộ: ${member.branch}\n` +
                `Ngày vào Đảng: ${member.partyDate ? new Date(member.partyDate).toLocaleDateString('vi-VN') : ''}`;
            alert(info);
        }
    }

    function deleteMember(id) {
        if (confirm('Bạn có chắc chắn muốn xóa đảng viên này?')) {
            members = members.filter(m => m.id !== id);
            filterMembersByBranch(currentBranch);
            updateDashboardStats();
            alert('Đã xóa đảng viên thành công');
        }
    }

    function deleteDocument(id) {
        if (confirm('Bạn có chắc chắn muốn xóa văn bản này?')) {
            documents = documents.filter(d => d.id !== id);
            filterDocumentsByType(currentDocType);
            updateDashboardStats();
            alert('Đã xóa văn bản thành công');
        }
    }

    function viewPhoto(id) {
        const member = members.find(m => m.id === id);
        if (member && member.photo) {
            window.open(member.photo, '_blank');
        } else {
            alert('Đảng viên chưa có ảnh');
        }
    }

    function saveMember() {
        const name = document.getElementById('memberName').value.trim();
        if (!name) {
            alert('Vui lòng nhập họ tên');
            return;
        }
        
        const memberData = {
            id: currentMemberId || Date.now(),
            name: name,
            dob: document.getElementById('memberDob').value,
            chinhquyen: document.getElementById('memberChinhquyen').value,
            dang: document.getElementById('memberDang').value,
            congdoan: document.getElementById('memberCongdoan').value,
            doan: document.getElementById('memberDoan').value,
            branch: document.getElementById('memberBranch').value,
            partyDate: document.getElementById('memberPartyDate').value,
            gender: 'Nam',
            photo: currentPhotoData || null
        };
        
        if (currentMemberId) {
            const index = members.findIndex(m => m.id === currentMemberId);
            if (index !== -1) {
                members[index] = { ...members[index], ...memberData };
            }
            alert('Đã cập nhật thông tin đảng viên thành công');
        } else {
            members.push(memberData);
            alert('Đã thêm đảng viên mới thành công');
        }
        
        filterMembersByBranch(currentBranch);
        updateDashboardStats();
        closeMemberModal();
    }

    function saveDocument() {
        const sohieu = document.getElementById('docSoHieu').value.trim();
        const tieude = document.getElementById('docTieuDe').value.trim();
        
        if (!sohieu) {
            alert('Vui lòng nhập số hiệu văn bản');
            return;
        }
        
        if (!tieude) {
            alert('Vui lòng nhập tiêu đề văn bản');
            return;
        }
        
        const docData = {
            id: currentDocumentId || Date.now(),
            sohieu: sohieu,
            loai: document.getElementById('docLoai').value,
            tieude: tieude,
            ngaybanhanh: document.getElementById('docNgayBanHanh').value,
            nguoiky: document.getElementById('docNguoiKy').value,
            noidung: document.getElementById('docNoiDung').value,
            noidungchitiet: document.getElementById('docNoiDungChiTiet').value,
            files: currentFiles,
            trangthai: document.getElementById('docTrangThai').value
        };
        
        if (currentDocumentId) {
            const index = documents.findIndex(d => d.id === currentDocumentId);
            if (index !== -1) {
                documents[index] = { ...documents[index], ...docData };
            }
            alert('Đã cập nhật văn bản thành công');
        } else {
            documents.push(docData);
            alert('Đã thêm văn bản mới thành công');
        }
        
        filterDocumentsByType(currentDocType);
        updateDashboardStats();
        closeDocumentModal();
    }

    function closeMemberModal() {
        document.getElementById('memberModal').classList.remove('active');
    }

    function closeDocumentModal() {
        document.getElementById('documentModal').classList.remove('active');
    }

    // ===== FORM RESET =====
    function resetMemberForm() {
        document.getElementById('memberName').value = '';
        document.getElementById('memberDob').value = '';
        document.getElementById('memberChinhquyen').value = '';
        document.getElementById('memberDang').value = '';
        document.getElementById('memberCongdoan').value = '';
        document.getElementById('memberDoan').value = '';
        document.getElementById('memberBranch').value = 'Văn phòng Trung tâm';
        document.getElementById('memberPartyDate').value = '';
    }

    function resetDocumentForm() {
        document.getElementById('docSoHieu').value = '';
        document.getElementById('docLoai').value = 'dinhky';
        document.getElementById('docTieuDe').value = '';
        document.getElementById('docNgayBanHanh').value = new Date().toISOString().split('T')[0];
        document.getElementById('docNguoiKy').value = '';
        document.getElementById('docNoiDung').value = '';
        document.getElementById('docNoiDungChiTiet').value = '';
        document.getElementById('docTrangThai').value = 'banhanh';
    }

    // ===== PHOTO UPLOAD HANDLERS =====
    function handlePhotoUpload(e) {
        const file = e.target.files[0];
        if (!file) return;

        if (file.size > 2 * 1024 * 1024) {
            alert('File ảnh không được vượt quá 2MB');
            return;
        }

        if (!file.type.match('image.*')) {
            alert('Chỉ chấp nhận file ảnh (JPG, PNG)');
            return;
        }

        currentPhotoFile = file;

        const reader = new FileReader();
        reader.onload = function(event) {
            currentPhotoData = event.target.result;
            
            const preview = document.getElementById('photoPreview');
            const img = document.getElementById('photoImage');
            
            img.src = event.target.result;
            preview.classList.add('has-image');
            
            const photoInfo = document.getElementById('photoInfo');
            if (photoInfo) {
                photoInfo.innerHTML = '<i class="fas fa-check-circle" style="color: #28a745;"></i> Đã chọn ảnh';
            }
        };
        reader.readAsDataURL(file);
    }

    function handleFileUpload(e) {
        const files = Array.from(e.target.files);
        
        files.forEach(file => {
            if (file.size > 20 * 1024 * 1024) {
                alert(`File ${file.name} vượt quá 20MB`);
                return;
            }
            
            const reader = new FileReader();
            reader.onload = function(event) {
                currentFiles.push({
                    name: file.name,
                    size: file.size,
                    type: file.name.split('.').pop().toLowerCase(),
                    data: event.target.result
                });
                updateFileList();
            };
            reader.readAsDataURL(file);
        });
        
        e.target.value = '';
    }

    function removePhoto() {
        currentPhotoFile = null;
        currentPhotoData = null;
        document.getElementById('photoUpload').value = '';
        
        const preview = document.getElementById('photoPreview');
        preview.classList.remove('has-image');
        document.getElementById('photoImage').src = '#';
        
        const photoInfo = document.getElementById('photoInfo');
        if (photoInfo) {
            photoInfo.innerHTML = '<i class="fas fa-info-circle"></i> JPG, PNG (tối đa 2MB)';
        }
    }

    function removeFile(index) {
        currentFiles.splice(index, 1);
        updateFileList();
    }

    function updateFileList() {
        const fileList = document.getElementById('fileList');
        if (!fileList) return;

        fileList.innerHTML = '';
        
        if (currentFiles.length === 0) {
            fileList.innerHTML = '<p style="color: var(--text-light); text-align: center;">Chưa có file đính kèm</p>';
            return;
        }
        
        currentFiles.forEach((file, index) => {
            const size = formatFileSize(file.size);
            const fileItem = document.createElement('div');
            fileItem.className = 'file-item';
            fileItem.innerHTML = `
                <div class="file-item-info">
                    <i class="fas ${getFileIcon(file.type)}"></i>
                    <span class="file-item-name">${file.name}</span>
                    <span class="file-item-size">${size}</span>
                </div>
                <i class="fas fa-times file-item-remove" onclick="removeFile(${index})"></i>
            `;
            fileList.appendChild(fileItem);
        });
    }

    // ===== SEARCH HANDLERS =====
    function handleMemberSearch(e) {
        const searchText = e.target.value.toLowerCase().trim();
        
        if (searchText === '') {
            filterMembersByBranch(currentBranch);
            return;
        }
        
        const filtered = members.filter(member => 
            member.name.toLowerCase().includes(searchText) ||
            (member.chinhquyen && member.chinhquyen.toLowerCase().includes(searchText)) ||
            (member.dang && member.dang.toLowerCase().includes(searchText)) ||
            (member.branch && member.branch.toLowerCase().includes(searchText))
        );
        
        renderMembersTable(filtered);
    }

    function handleDocumentSearch(e) {
        const searchText = e.target.value.toLowerCase().trim();
        
        if (searchText === '') {
            filterDocumentsByType(currentDocType);
            return;
        }
        
        const filtered = documents.filter(doc => 
            doc.tieude.toLowerCase().includes(searchText) ||
            doc.sohieu.toLowerCase().includes(searchText) ||
            (doc.noidung && doc.noidung.toLowerCase().includes(searchText))
        );
        
        renderDocumentsTable(filtered);
    }

    function handleDocTypeFilter(e) {
        const value = e.target.value;
        if (value === 'all') {
            renderDocumentsTable(documents);
        } else {
            filterDocumentsByType(value);
        }
    }

    // ===== UTILITY FUNCTIONS =====
    function formatFileSize(bytes) {
        if (bytes === 0) return '0 Bytes';
        const k = 1024;
        const sizes = ['Bytes', 'KB', 'MB', 'GB'];
        const i = Math.floor(Math.log(bytes) / Math.log(k));
        return parseFloat((bytes / Math.pow(k, i)).toFixed(2)) + ' ' + sizes[i];
    }

    function getFileIcon(type) {
        const icons = {
            'pdf': 'fa-file-pdf',
            'doc': 'fa-file-word',
            'docx': 'fa-file-word',
            'xls': 'fa-file-excel',
            'xlsx': 'fa-file-excel',
            'jpg': 'fa-file-image',
            'jpeg': 'fa-file-image',
            'png': 'fa-file-image',
            'txt': 'fa-file-alt'
        };
        return icons[type] || 'fa-file';
    }

    function debounce(func, wait) {
        let timeout;
        return function executedFunction(...args) {
            const later = () => {
                clearTimeout(timeout);
                func(...args);
            };
            clearTimeout(timeout);
            timeout = setTimeout(later, wait);
        };
    }

    function updateDashboardStats() {
        const totalMembers = members.length;
        const totalDocs = documents.length;
        const dinhkyDocs = documents.filter(d => d.loai === 'dinhky').length;
        const pendingDocs = documents.filter(d => d.trangthai === 'chopheduyet').length;
        const chuyendeDocs = documents.filter(d => d.loai === 'chuyende').length;
        
        const totalDocsEl = document.getElementById('totalDocuments');
        const dinhkyDocsEl = document.getElementById('dinhkyDocs');
        const chuyendeDocsEl = document.getElementById('chuyendeDocs');
        const pendingDocsEl = document.getElementById('pendingDocs');
        const memberStatsEl = document.getElementById('memberStats');
        const moduleDocStatsEl = document.getElementById('moduleDocStats');
        
        if (totalDocsEl) totalDocsEl.innerText = totalDocs;
        if (dinhkyDocsEl) dinhkyDocsEl.innerText = dinhkyDocs;
        if (chuyendeDocsEl) chuyendeDocsEl.innerText = chuyendeDocs;
        if (pendingDocsEl) pendingDocsEl.innerText = pendingDocs;
        if (memberStatsEl) memberStatsEl.innerHTML = `${totalMembers} đảng viên`;
        if (moduleDocStatsEl) moduleDocStatsEl.innerHTML = `${totalDocs} văn bản`;
        
        updateActivityList();
    }

    function updateActivityList() {
        const activityList = document.getElementById('dashboardActivityList');
        if (!activityList) return;

        activityList.innerHTML = '';
        
        const activities = [];
        
        members.slice(0, 2).forEach(m => {
            activities.push({
                icon: 'fa-user-plus',
                title: 'Thêm đảng viên mới',
                desc: `Đồng chí ${m.name}`,
                time: 'Vừa xong'
            });
        });
        
        documents.slice(0, 2).forEach(d => {
            const ngay = d.ngaybanhanh ? new Date(d.ngaybanhanh).toLocaleDateString('vi-VN') : '';
            activities.push({
                icon: 'fa-file-alt',
                title: d.tieude,
                desc: `${d.sohieu} - ${ngay}`,
                time: 'Gần đây'
            });
        });
        
        if (activities.length === 0) {
            activities.push({
                icon: 'fa-info-circle',
                title: 'Chào mừng bạn đến với hệ thống',
                desc: 'Quản lý công tác Đảng phiên bản 2.0',
                time: 'Bây giờ'
            });
        }
        
        activities.slice(0, 3).forEach(act => {
            const item = document.createElement('div');
            item.className = 'activity-item';
            item.innerHTML = `
                <div class="activity-icon"><i class="fas ${act.icon}"></i></div>
                <div class="activity-content">
                    <div class="activity-title">${act.title}</div>
                    <div class="activity-desc">${act.desc}</div>
                </div>
                <div class="activity-time">${act.time}</div>
            `;
            activityList.appendChild(item);
        });
    }

    // ===== SAMPLE DATA =====
    function getSampleMembers() {
        return [
            {
                id: 1,
                name: 'Vũ Nam Thắng',
                gender: 'Nam',
                dob: '1975-05-15',
                chinhquyen: 'Giám đốc',
                dang: 'Bí thư Đảng ủy',
                congdoan: 'Ủy viên BCH',
                doan: '',
                branch: 'Văn phòng Trung tâm',
                partyDate: '2000-05-15',
                photo: null
            },
            {
                id: 2,
                name: 'Hồ Xuân Hoà',
                gender: 'Nam',
                dob: '1978-08-20',
                chinhquyen: 'Phó Giám đốc',
                dang: 'Phó Bí thư',
                congdoan: 'Chủ tịch CĐ',
                doan: '',
                branch: 'Văn phòng Trung tâm',
                partyDate: '2002-08-20',
                photo: null
            },
            {
                id: 3,
                name: 'Trần Thị Lan',
                gender: 'Nữ',
                dob: '1985-03-10',
                chinhquyen: 'Trưởng phòng',
                dang: 'Đảng viên',
                congdoan: 'Trưởng ban Nữ công',
                doan: 'Bí thư Đoàn',
                branch: 'Văn phòng Trung tâm',
                partyDate: '2010-03-10',
                photo: null
            },
            {
                id: 4,
                name: 'Lê Văn Cường',
                gender: 'Nam',
                dob: '1980-12-02',
                chinhquyen: 'Đội trưởng',
                dang: 'Bí thư Chi bộ',
                congdoan: 'Tổ trưởng CĐ',
                doan: '',
                branch: 'Đội Bảo trì Sân đường',
                partyDate: '2005-12-02',
                photo: null
            }
        ];
    }

    function getSampleDocuments() {
        return [
            {
                id: 1,
                sohieu: '01/NQ-ĐU',
                tieude: 'Nghị quyết về công tác xây dựng Đảng năm 2026',
                loai: 'dinhky',
                ngaybanhanh: '2026-01-15',
                nguoiky: 'Vũ Nam Thắng',
                noidung: 'Nghị quyết về công tác xây dựng Đảng năm 2026',
                noidungchitiet: 'Nghị quyết này đề ra các mục tiêu, nhiệm vụ trọng tâm về công tác xây dựng Đảng trong năm 2026...',
                files: [
                    { name: 'NQ-01-2026.pdf', size: 1240000, type: 'pdf' }
                ],
                trangthai: 'banhanh'
            },
            {
                id: 2,
                sohieu: '02/NQ-ĐU',
                tieude: 'Nghị quyết về công tác cán bộ nhiệm kỳ 2025-2030',
                loai: 'chuyende',
                ngaybanhanh: '2026-02-20',
                nguoiky: 'Hồ Xuân Hoà',
                noidung: 'Nghị quyết về công tác cán bộ',
                noidungchitiet: 'Nghị quyết này quy định về công tác quy hoạch, đào tạo, bổ nhiệm cán bộ...',
                files: [
                    { name: 'NQ-02-2026.pdf', size: 890000, type: 'pdf' },
                    { name: 'PhuLuc.xlsx', size: 560000, type: 'xlsx' }
                ],
                trangthai: 'chopheduyet'
            },
            {
                id: 3,
                sohieu: '03/QT-ĐU',
                tieude: 'Quy trình xử lý văn bản đến và đi',
                loai: 'quytrinh',
                ngaybanhanh: '2026-03-10',
                nguoiky: 'Trần Thị Lan',
                noidung: 'Quy trình xử lý văn bản',
                noidungchitiet: 'Quy trình này hướng dẫn chi tiết các bước tiếp nhận, xử lý, ban hành văn bản...',
                files: [
                    { name: 'QT-03-2026.pdf', size: 2100000, type: 'pdf' }
                ],
                trangthai: 'banhanh'
            }
        ];
    }

    // Export functions to global scope for onclick handlers
    window.showDocumentDetail = showDocumentDetail;
    window.viewMember = viewMember;
    window.editMember = editMember;
    window.deleteMember = deleteMember;
    window.viewPhoto = viewPhoto;
    window.editDocument = editDocument;
    window.deleteDocument = deleteDocument;
    window.downloadFile = (name) => alert('Đang tải file: ' + name);
    window.closeMemberModal = closeMemberModal;
    window.closeDocumentModal = closeDocumentModal;
    window.removePhoto = removePhoto;
    window.removeFile = removeFile;
</script>
</body>
</html>

